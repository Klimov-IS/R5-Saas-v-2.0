# TASK — R5 Documentation System Design & Full Documentation Build

## Контекст

Проект **R5 (Reputation Management Service)** находится в продакшене и активно используется.  
На текущий момент отсутствует единая, формализованная и масштабируемая система документации, которая:

- фиксирует **Source of Truth** по БД, cron jobs, API и продуктовой логике
- позволяет **быстро ориентироваться в проекте** без повторного полного анализа
- задаёт **правила работы для AI-агента (Claude Code)** и разработчиков
- автоматически поддерживается и обновляется при изменениях системы

Цель данной задачи — **разработать полноценный комплект проектной документации** и заложить правила её дальнейшего сопровождения.

---

## Цель задачи (Goal)

1. Разработать **базовый комплект из 10 ключевых документов** для проекта R5  
2. Зафиксировать **структуру папки `docs/`** и роли документов  
3. Сделать документацию:
   - продуктовой
   - инженерной
   - AI-first
4. Обеспечить, чтобы документация позволяла:
   - не переанализировать проект с нуля
   - быстро понимать логику табов, автоматизаций, БД и ИИ
5. По завершении:
   - подготовить **краткий отчёт**
   - предложить **ещё 5–10 документов**, выявленных в процессе анализа проекта

---

## Область работ (Scope)

### 1. Разработка обязательного набора документации (10 документов)

Необходимо разработать следующие документы:

1. **README.md**  
   Product & System Overview, точка входа в проект

2. **docs/ARCHITECTURE.md**  
   Архитектура системы, слои, потоки данных, структура репозитория

3. **docs/reference/database-schema.md**  
   Source of Truth по БД:
   - таблицы
   - связи
   - статусы
   - индексы
   - snapshot-логика

4. **DEPLOYMENT.md**  
   Deployment & Rollback Runbook

5. **CRON_JOBS.md**  
   Все cron jobs и автоматизации:
   - расписание
   - лимиты
   - идемпотентность
   - фейлы и повторы

6. **docs/reference/api.md**  
   Карта внутренних API:
   - эндпоинты
   - назначение
   - вход / выход
   - используемые домены

7. **docs/product/cabinets.md**  
   Страница **«Кабинеты»**:
   - роль страницы
   - жизненный цикл кабинета
   - агрегируемые данные
   - ключевые действия и триггеры

8. **docs/product/client-tabs.md**  
   Табы кабинета клиента (**ключевой anti-overanalysis документ**):
   - Товары
   - Отзывы
   - Чаты  
   Для каждого:
   - данные
   - фильтры
   - загрузка
   - бизнес-логика
   - влияние на автоматизации

9. **docs/domains/complaints.md**  
   Логика генерации жалоб:
   - правила
   - лимиты
   - cron-интеграция
   - backfill
   - edge cases

10. **docs/domains/chats-ai.md**  
    AI в чатах:
    - роль ИИ
    - сценарии общения
    - ограничения
    - stop conditions
    - связь с компенсациями и жалобами

---

## Структура папки `docs/` (обязательная)

Документация должна быть разложена строго по следующей структуре:

```text
docs/
  _rules/
    DOCS_UPDATE_POLICY.md
    DB_POLICY.md
    CRON_POLICY.md
    DEPLOY_POLICY.md

  reference/
    database-schema.md
    api.md
    metrics.md

  product/
    cabinets.md
    client-tabs.md

  domains/
    complaints.md
    chats-ai.md

  runbooks/
    deployment.md
    cron-jobs.md

  decisions/
    ADR-000-template.md

  tasks/
    TASK-template.md

  archive/
❗ Документы в корне репозитория (README.md, DEPLOYMENT.md, CRON_JOBS.md) должны быть логически связаны и/или продублированы ссылками из docs/.

Требования к качеству документации

Документация должна быть:

структурированной

актуальной

однозначной

Каждый документ должен:

чётко описывать свою роль

ссылаться на связанные документы

Избегать дублирования логики — использовать ссылки

Фокус:

как работает система

почему она так устроена

где что менять и где опасно

Документация как процесс (обязательно)

В рамках задачи необходимо также:

Разработать правила обновления документации:

при изменении БД

при добавлении API

при изменении cron jobs

Зафиксировать это в:

docs/_rules/DOCS_UPDATE_POLICY.md

Описать:

что является Source of Truth

что делать при расхождении кода и docs

Ограничения

❌ Не вносить изменения в код

❌ Не менять данные в БД

❌ Не удалять существующие документы без согласования

✅ Только анализ, описание, структурирование

Формат итогового отчёта (обязателен)

После завершения разработки документации необходимо подготовить краткий итоговый отчёт, включающий:

Что было сделано

Какие зоны проекта оказались наиболее сложными / критичными

Какие допущения были сделаны

Список ещё 5–10 документов, которые целесообразно разработать дополнительно
(на основе анализа проекта в процессе работы)

Definition of Done (DoD)

Задача считается выполненной, если:

Разработаны все 10 документов

Документы разложены по утверждённой структуре

Есть правила обновления документации

Документация позволяет:

понять проект без повторного полного анализа

безопасно работать с БД, cron jobs и автоматизациями

Подготовлен итоговый отчёт + предложения по расширению документации

Следующий шаг после задачи

После принятия результата:

Утверждение дополнительного списка документов

Планирование следующего этапа документации

Интеграция правил docs-update в рабочий процесс (CI / чек-листы)