# TASK-20260209: Дашборд Продуктовой Аналитики

**Дата:** 2026-02-09
**Статус:** Запланировано
**Приоритет:** Высокий

---

## Цель

Создать Google Sheets дашборд с ключевыми метриками для оценки эффективности бизнеса R5.

---

## Бизнес-контекст

Клиент платит за:
1. Удаление негативных отзывов (через жалобы) → **600₽/отзыв**
2. Работу с диалогами (удаление через переговоры) → **600₽/отзыв**
3. Ежемесячный отчёт по работе → абонентская плата

---

## Структура метрик

### 1. Обзор бизнеса
- Магазинов (активных)
- Товаров (в работе)
- Отзывов всего
- Негативных (1-3★)
- Диалогов всего

### 2. Воронка жалоб
- Сгенерировано → Черновик → Отправлено → Одобрено/Отклонено
- **Approval Rate %**
- **Конверсия отправки %**

### 3. Воронка удаления
- Кандидаты → Предложено → Согласились → Удалено
- **Deletion Rate %**

### 4. Финансы
- Выручка от жалоб (approved × 600₽)
- Выручка от удалений (confirmed × 600₽)
- Расходы AI ($)
- **Итого выручка**

### 5. Эффективность
- Покрытие негативов жалобами %
- Скорость отправки
- Approval Rate по категориям

---

## Решение

**Формат:** Google Sheets (новый лист "Аналитика")
**Доступ:** Только админ
**Периодичность:** Еженедельные тренды + текущее состояние

### Колонки (21 шт)

| Колонка | Содержимое |
|---------|------------|
| A | Дата |
| B | Период ("Текущее" / "Неделя 2026-W06") |
| C-F | Магазины, товары, отзывы, негативные |
| G-K | Жалобы (генерация → одобрение) |
| L | Approval Rate % |
| M-O | Диалоги, кандидаты, удалено |
| P | Deletion Rate % |
| Q-S | Выручка (жалобы, удаления, итого) |
| T | Расходы AI |
| U | Покрытие негативов % |

---

## Реализация

### Новые файлы

```
src/services/google-sheets-sync/analytics/
├── index.ts
├── sync-service.ts
├── metrics-collector.ts
├── row-formatter.ts
└── types.ts

src/app/api/admin/google-sheets/
└── sync-analytics/route.ts
```

### CRON job

- Расписание: Понедельник 7:00 MSK
- Добавляет строку с данными за прошедшую неделю

### Ручной триггер

`POST /api/admin/google-sheets/sync-analytics`

---

## План работ

1. [ ] Создать metrics-collector.ts — SQL запросы
2. [ ] Создать sync-service.ts — логика upsert
3. [ ] Создать API endpoint
4. [ ] Добавить CRON job
5. [ ] Настроить лист в Google Sheets

---

## Верификация

1. Запустить sync-analytics вручную
2. Проверить лист "Аналитика"
3. Проверить все метрики
4. Подождать понедельник — проверить автодобавление

---

## Связанные документы

- План: `C:\Users\79025\.claude\plans\curious-growing-giraffe.md`
- Схема БД: `docs/database-schema.md`
- Существующая статистика: `src/db/helpers.ts`, `src/db/extension-helpers.ts`
