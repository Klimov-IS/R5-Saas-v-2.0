# –î–æ–º–µ–Ω: AI –≤ —á–∞—Ç–∞—Ö

**–î–∞—Ç–∞:** 2026-02-09
**–í–µ—Ä—Å–∏—è:** 2.0
**AI Model:** Deepseek Chat (`deepseek-chat`)
**API Endpoint:** `https://api.deepseek.com/chat/completions`

---

## –û–±–∑–æ—Ä

AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤ —á–∞—Ç–∞—Ö –ø–æ–º–æ–≥–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —á–∞—Ç—ã –∏ –ø–æ–º–æ–≥–∞–µ—Ç –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ AI

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
2. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —á–∞—Ç–æ–≤** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ (12 —Ç–µ–≥–æ–≤)
3. **Deletion classification** ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ (regex + AI)
4. **Deletion offers** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–± —É–¥–∞–ª–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞
5. **Bulk operations** ‚Äî –º–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Ç–æ–≤

---

## –¢–µ–≥–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã

### ChatTag (12 —Ç–µ–≥–æ–≤) ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —á–∞—Ç–∞

> Source of truth: `src/types/chats.ts`

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (6):**

| –¢–µ–≥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö—Ä–∏—Ç–µ—Ä–∏–∏ |
|-----|----------|----------|
| `active` | –ê–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ | –¢—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞ |
| `successful` | –£—Å–ø–µ—à–Ω–æ —Ä–µ—à—ë–Ω | –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞, –∫–ª–∏–µ–Ω—Ç –¥–æ–≤–æ–ª–µ–Ω |
| `unsuccessful` | –ù–µ —Ä–µ—à—ë–Ω | –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï —Ä–µ—à–µ–Ω–∞, –∫–ª–∏–µ–Ω—Ç –Ω–µ–¥–æ–≤–æ–ª–µ–Ω |
| `no_reply` | –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ | –ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ |
| `untagged` | –ù–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `completed` | –ó–∞–≤–µ—Ä—à—ë–Ω | –î–∏–∞–ª–æ–≥ –æ–∫–æ–Ω—á–µ–Ω, –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è |

**Deletion workflow (6):**

| –¢–µ–≥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö—Ä–∏—Ç–µ—Ä–∏–∏ |
|-----|----------|----------|
| `deletion_candidate` | –ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ | AI –æ–±–Ω–∞—Ä—É–∂–∏–ª –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ |
| `deletion_offered` | –û—Ñ—Ñ–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω | –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É |
| `deletion_agreed` | –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–∏–ª—Å—è | –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–∏–ª—Å—è —É–¥–∞–ª–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç–∑—ã–≤ |
| `deletion_confirmed` | –û—Ç–∑—ã–≤ —É–¥–∞–ª—ë–Ω/–∏–∑–º–µ–Ω—ë–Ω | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ |
| `refund_requested` | –ó–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ | –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç –≤–æ–∑–≤—Ä–∞—Ç –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞ |
| `spam` | –°–ø–∞–º | –°–ø–∞–º, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |

### ChatStatus (5 —Å—Ç–∞—Ç—É—Å–æ–≤ Kanban)

> Source of truth: `src/types/chats.ts`

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|----------|---------------|
| `inbox` | –í—Ö–æ–¥—è—â–∏–µ | –ù–æ–≤—ã–µ/–Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —á–∞—Ç—ã |
| `in_progress` | –í —Ä–∞–±–æ—Ç–µ | –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —á–∞—Ç–æ–º |
| `awaiting_reply` | –û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ | –ñ–¥—ë–º –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∏) |
| `resolved` | –†–µ—à–µ–Ω–æ | –í–æ–ø—Ä–æ—Å —Ä–µ—à—ë–Ω |
| `closed` | –ó–∞–∫—Ä—ã—Ç–æ | –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã—Ç (—Ç—Ä–µ–±—É–µ—Ç `completion_reason`) |

**–í–∞–∂–Ω–æ:** ChatTag = AI-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ. ChatStatus = –ø–æ–∑–∏—Ü–∏—è –Ω–∞ Kanban-–¥–æ—Å–∫–µ (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é).

---

## AI Flows

### 1. Generate Chat Reply

**Flow:** `src/ai/flows/generate-chat-reply-flow.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface GenerateChatReplyInput {
  context: string;   // –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: –º–∞–≥–∞–∑–∏–Ω + —Ç–æ–≤–∞—Ä + –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞)
  storeId: string;   // ID –º–∞–≥–∞–∑–∏–Ω–∞ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
  ownerId: string;   // ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
  chatId: string;    // ID —á–∞—Ç–∞ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface GenerateChatReplyOutput {
  text: string;      // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
}
```

> –ú–µ—Ç—Ä–∏–∫–∏ (tokens, cost, duration) –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `ai_logs` —á–µ—Ä–µ–∑ `runChatCompletion`, –∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ output.

**–õ–æ–≥–∏–∫–∞:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ `user_settings.prompt_chat_reply`
2. –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí –æ—à–∏–±–∫–∞ (–¥–µ—Ñ–æ–ª—Ç–∞ –Ω–µ—Ç)
3. –í—ã–∑–æ–≤ Deepseek API —á–µ—Ä–µ–∑ `runChatCompletion()`
4. –í–æ–∑–≤—Ä–∞—Ç —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `ai_logs`

**–ü—Ä–æ–º–ø—Ç:** –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (`user_settings.prompt_chat_reply`). –í—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `context` –∫–∞–∫ —Å—Ç—Ä–æ–∫—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–∞–≥–∞–∑–∏–Ω–µ, —Ç–æ–≤–∞—Ä–µ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞.

---

### 2. Classify Chat Tag

**Flow:** `src/ai/flows/classify-chat-tag-flow.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —á–∞—Ç–∞ –ø–æ —Ç–µ–≥–∞–º.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ClassifyChatTagInput {
  chatHistory: string;     // –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
  lastMessageText: string; // –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ regex-–∞–Ω–∞–ª–∏–∑–∞)
  storeId: string;
  ownerId: string;
  chatId: string;
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ClassifyChatTagOutput {
  tag: ChatTag;              // –û–¥–∏–Ω –∏–∑ 12 —Ç–µ–≥–æ–≤
  confidence: number;        // 0-1
  reasoning?: string;        // –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ AI
  triggers?: string[];       // –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ñ—Ä–∞–∑—ã
}
```

**–ü—Ä–æ–º–ø—Ç:** `user_settings.prompt_chat_tag`

---

### 3. Classify Chat Deletion

**Flow:** `src/ai/flows/classify-chat-deletion-flow.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ —á–∞—Ç –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞. –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥: regex + AI.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ClassifyChatDeletionInput {
  chatHistory: string;
  lastMessageText: string;
  storeId: string;
  ownerId: string;
  chatId: string;
  productName?: string;
  productRules?: {
    work_in_chats: boolean;
    offer_compensation: boolean;
    chat_strategy?: 'upgrade_to_5' | 'delete' | 'both';
    max_compensation?: string;
  };
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ClassifyChatDeletionOutput {
  tag: ChatTag;              // –û–¥–∏–Ω –∏–∑ 12 —Ç–µ–≥–æ–≤
  confidence: number;        // 0-1
  reasoning?: string;        // –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (regex –∏–ª–∏ AI)
  triggers?: string[];       // –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ñ—Ä–∞–∑—ã
}
```

**–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ª–æ–≥–∏–∫–∞:**

```
–≠—Ç–∞–ø 1: Regex (–±—ã—Å—Ç—Ä–æ, ~0ms)
  ‚îú‚îÄ‚îÄ detectDeletionIntent(lastMessageText) ‚Äî src/db/chat-deletion-helpers.ts
  ‚îú‚îÄ‚îÄ –ï—Å–ª–∏ confidence >= 0.90 ‚Üí —Å—Ä–∞–∑—É tag='deletion_candidate' (–±–µ–∑ AI)
  ‚îú‚îÄ‚îÄ –ï—Å–ª–∏ spam_caps ‚Üí —Å—Ä–∞–∑—É tag='spam'
  ‚îî‚îÄ‚îÄ –ò–Ω–∞—á–µ ‚Üí –≠—Ç–∞–ø 2

–≠—Ç–∞–ø 2: AI (Deepseek, ~2-3—Å)
  ‚îú‚îÄ‚îÄ –ü—Ä–æ–º–ø—Ç: prompt_chat_deletion_tag (fallback: prompt_chat_tag)
  ‚îú‚îÄ‚îÄ –ö–æ–Ω—Ç–µ–∫—Å—Ç: –∏—Å—Ç–æ—Ä–∏—è + —Ç–æ–≤–∞—Ä + product_rules + regex-–ø–æ–¥—Å–∫–∞–∑–∫–∏
  ‚îú‚îÄ‚îÄ JSON response ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod
  ‚îî‚îÄ‚îÄ Fallback: –µ—Å–ª–∏ AI —É–ø–∞–ª ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º regex-—Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

**–¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ñ—Ä–∞–∑—ã (regex):**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–º–µ—Ä | Confidence |
|-----------|--------|------------|
| –ü—Ä—è–º–æ–µ –æ–±–µ—â–∞–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å | "—É–¥–∞–ª—é –æ—Ç–∑—ã–≤", "—É–±–µ—Ä—É –æ—Ç–∑—ã–≤" | 95-98% |
| –û–±–µ—â–∞–Ω–∏–µ 5 –∑–≤—ë–∑–¥ | "–ø–æ—Å—Ç–∞–≤–ª—é 5", "–∏–∑–º–µ–Ω—é –Ω–∞ 5" | 94-96% |
| –ó–∞–ø—Ä–æ—Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ | "–≤–µ—Ä–Ω–∏—Ç–µ –¥–µ–Ω—å–≥–∏", "—Ö–æ—á—É –≤–æ–∑–≤—Ä–∞—Ç" | 84-92% |
| –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | "–≤–µ—Ä–Ω–∏—Ç–µ –¥–µ–Ω—å–≥–∏... —É–¥–∞–ª—é –æ—Ç–∑—ã–≤" | 94-96% |
| –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç | "–±—Ä–∞–∫", "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç" | 78-82% |
| –°–ø–∞–º | ALL CAPS —Ç–µ–∫—Å—Ç | 100% |

**–ü–æ—Ä–æ–≥ –¥–ª—è deletion_candidate:** confidence >= 0.80

**–ü—Ä–æ–º–ø—Ç:** Hardcoded –≤ `src/ai/prompts/chat-deletion-classification-prompt.ts` (~3800 —Å–∏–º–≤–æ–ª–æ–≤, —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)

---

### 4. Generate Deletion Offer

**Flow:** `src/ai/flows/generate-deletion-offer-flow.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞.

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface GenerateDeletionOfferOutput {
  messageText: string;                                    // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  offerAmount: number;                                    // –°—É–º–º–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
  strategy: 'upgrade_to_5' | 'delete' | 'both';         // –°—Ç—Ä–∞—Ç–µ–≥–∏—è
  tone?: 'empathetic' | 'apologetic' | 'professional' | 'friendly';
  estimatedSuccessRate?: number;                          // 0-1
}
```

**–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω—ã–π):**

| –†–µ–π—Ç–∏–Ω–≥ –æ—Ç–∑—ã–≤–∞ | % –æ—Ç max_compensation |
|----------------|----------------------|
| 1 –∑–≤–µ–∑–¥–∞ | 100% |
| 2 –∑–≤–µ–∑–¥—ã | 80% |
| 3 –∑–≤–µ–∑–¥—ã | 60% |
| 4 –∑–≤–µ–∑–¥—ã | 40% |
| 5 –∑–≤—ë–∑–¥ | 20% |

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: 50 —Ä—É–±.

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----------|----------|--------------------|
| `upgrade_to_5` | –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–≤—ã—Å–∏—Ç—å –æ—Ü–µ–Ω–∫—É –¥–æ 5 | –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã |
| `delete` | –î–µ–ª–∏–∫–∞—Ç–Ω—ã–π –Ω–∞–º—ë–∫ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ (–±–µ–∑ –ø—Ä—è–º–æ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è!) | –ö–ª–∏–µ–Ω—Ç —É–∂–µ –Ω–∞–º–µ–∫–∞–ª |
| `both` | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ–∫—É—Å –Ω–∞ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã | –ù–µ—è—Å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è |

**–í–∞–∂–Ω–æ:** –ü—Ä—è–º–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ "—É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤" –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º–∏ WB. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–Ω–∫–∏–µ –Ω–∞–º—ë–∫–∏: "–Ω–∞–¥–µ–µ–º—Å—è –Ω–∞ –≤–∞—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ", "–≥–æ—Ç–æ–≤—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é".

**–ü—Ä–æ–º–ø—Ç:** Hardcoded –≤ `src/ai/prompts/deletion-offer-prompt.ts` (~5200 —Å–∏–º–≤–æ–ª–æ–≤)

**Fallback:** –ï—Å–ª–∏ AI —É–ø–∞–ª ‚Üí —à–∞–±–ª–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å—É–º–º–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏.

---

## AI Backend

### runChatCompletion()

**–§–∞–π–ª:** `src/ai/assistant-utils.ts`

–û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö AI-–≤—ã–∑–æ–≤–æ–≤:

```typescript
async function runChatCompletion({
  systemPrompt: string,
  userContent: string,
  isJsonMode?: boolean,
  operation: string,       // 'generate-chat-reply', 'classify-chat-deletion', etc.
  storeId: string,
  ownerId: string,
  entityType: string,      // 'chat', 'review'
  entityId: string,
}): Promise<string>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã Deepseek API:**
- Model: `deepseek-chat`
- Temperature: 0.7
- Max tokens: 2048
- JSON mode: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (`response_format: { type: 'json_object' }`)
- Auth: Bearer token –∏–∑ `user_settings` –∏–ª–∏ env `DEEPSEEK_API_KEY`

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- Input: $0.14 / 1M tokens
- Output: $0.28 / 1M tokens
- ~$0.0001-0.0003 –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç

```
[–ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤–æ–ø—Ä–æ—Å –æ —Ç–æ–≤–∞—Ä–µ]
       ‚Üì
[–ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç]
       ‚Üì
[–ù–∞–∂–∏–º–∞–µ—Ç "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI"]
       ‚Üì
[AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ draft_reply]
       ‚Üì
[–ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)]
       ‚Üì
[–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WB API]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

```
[–ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–∞–± –ß–∞—Ç—ã]
       ‚Üì
[POST /api/stores/:id/chats/classify-all]
       ‚Üì
[AI –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —á–∞—Ç (12 —Ç–µ–≥–æ–≤)]
       ‚Üì
[–û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–µ–≥–∏ –≤ –ë–î]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Deletion workflow

```
[Dialogue Sync –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]
       ‚Üì
[classifyChatDeletion() ‚Üí regex + AI]
       ‚Üì
[–ï—Å–ª–∏ deletion_candidate ‚Üí –º–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä]
       ‚Üì
[–ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ"]
       ‚Üì
[generateDeletionOffer() ‚Üí —Ä–∞—Å—á—ë—Ç —Å—É–º–º—ã + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞]
       ‚Üì
[–°–æ–∑–¥–∞—ë—Ç—Å—è deletion_case –≤ –ë–î]
       ‚Üì
[–ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí —Ç–µ–≥ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ deletion_offered]
       ‚Üì
[–ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è ‚Üí deletion_agreed ‚Üí deletion_confirmed]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–≤—Ç–æ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```
[CRON: Adaptive Dialogue Sync (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω)]
       ‚Üì
[–ü–æ–ª—É—á–µ–Ω—ã –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç WB API]
       ‚Üì
[–î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ —Å –Ω–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: classifyChatDeletion()]
       ‚Üì
[–¢–µ–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏]
```

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è AI

### 1. Context window
- –ú–∞–∫—Å–∏–º—É–º 20 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –î–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤

### 2. Rate limiting
- 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –∫ Deepseek
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Üí –æ—à–∏–±–∫–∞ 429

### 3. –°—Ç–æ–∏–º–æ—Å—Ç—å
- ~$0.0001-0.0003 –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–µ—à–µ–≤–ª–µ (–º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤)

### 4. –ö–∞—á–µ—Å—Ç–≤–æ
- –¢—Ä–µ–±—É–µ—Ç—Å—è review —á–µ–ª–æ–≤–µ–∫–æ–º –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –í–æ–∑–º–æ–∂–Ω—ã –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è tone of voice –±—Ä–µ–Ω–¥–∞

---

## Stop Conditions

AI **–ù–ï –¥–æ–ª–∂–µ–Ω** –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ:

1. –û–±–µ—â–∞—é—Ç —Ç–æ, —á—Ç–æ –Ω–µ–ª—å–∑—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å
2. –†–∞—Å–∫—Ä—ã–≤–∞—é—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
3. –°–æ–¥–µ—Ä–∂–∞—Ç –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
4. –î–∞—é—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
5. –û–±—Å—É–∂–¥–∞—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
6. –ü—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
7. –ù–∞–ø—Ä—è–º—É—é —É–ø–æ–º–∏–Ω–∞—é—Ç "—É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞" (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª WB)

---

## API Endpoints

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞

```http
POST /api/stores/:storeId/chats/:chatId/generate-ai
Authorization: Bearer {token}
```

**Response:**
```json
{
  "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ..."
}
```

> draft_reply —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

```http
POST /api/stores/:storeId/chats/classify-all
Authorization: Bearer {token}
```

### Deletion classification

```http
POST /api/stores/:storeId/chats/classify-deletion
Authorization: Bearer {token}
```

### Deletion offer

```http
POST /api/stores/:storeId/chats/:chatId/generate-deletion-offer
Authorization: Bearer {token}
```

> –ü–∞—Ä–∞–º–µ—Ç—Ä `?autoSend=true` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ **–ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** (TODO –≤ –∫–æ–¥–µ).

### Bulk –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```http
POST /api/stores/:storeId/chats/bulk/generate-ai
Authorization: Bearer {token}
Content-Type: application/json

{
  "chatIds": ["id1", "id2", "id3"]
}
```

> –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ chatIds. –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "all" –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### Bulk –æ—Ç–ø—Ä–∞–≤–∫–∞

```http
POST /api/stores/:storeId/chats/bulk/send
Authorization: Bearer {token}
Content-Type: application/json

{
  "chatIds": ["id1", "id2", "id3"]
}
```

> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç draft_reply –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞. –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `awaiting_reply`.

### –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ (Kanban)

```http
PATCH /api/stores/:storeId/chats/:chatId/status
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "awaiting_reply",
  "completion_reason": "review_deleted"  // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ closed
}
```

---

## AI Context Injection (Per-Store Personalization)

**–§–∞–π–ª:** `src/lib/ai-context.ts`

–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∂–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ system prompt AI. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

### buildStoreInstructions(storeId, aiInstructions?)

```typescript
async function buildStoreInstructions(
  storeId: string,
  aiInstructions?: string | null
): Promise<string | undefined>
```

**–û–±—ä–µ–¥–∏–Ω—è–µ—Ç:**

1. **AI Instructions** (`stores.ai_instructions`) ‚Äî —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: —Ç–æ–Ω, –ø—Ä–∞–≤–∏–ª–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
2. **FAQ** (`store_faq`) ‚Äî –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `## FAQ –º–∞–≥–∞–∑–∏–Ω–∞\n–í: ...\n–û: ...`
3. **Guides** (`store_guides`) ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤\n### Title\nContent`

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 6 customer-facing flows:**
- generate-chat-reply
- classify-chat-tag
- classify-chat-deletion
- generate-deletion-offer
- generate-review-reply
- generate-question-reply

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** generate-review-complaint (–∂–∞–ª–æ–±–∞ ‚Äî –Ω–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ—Ç–≤–µ—Ç)

### FAQ Templates

**–§–∞–π–ª:** `src/lib/faq-templates.ts`

27 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö FAQ –ø–∞—Ä –≤ 9 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ 5000+ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤):
- –í–æ–∑–≤—Ä–∞—Ç—ã, –ë—Ä–∞–∫, –†–∞–∑–º–µ—Ä—ã, –î–æ—Å—Ç–∞–≤–∫–∞, –ö–∞—á–µ—Å—Ç–≤–æ, –ö–æ–º–ø–ª–µ–∫—Ç–Ω–æ—Å—Ç—å, –û–±–º–µ–Ω, –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è, –û–ø–∏—Å–∞–Ω–∏–µ

### Guide Templates

**–§–∞–π–ª:** `src/lib/guide-templates.ts`

7 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ 2000+ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–¥–∞–≤—Ü–æ–≤):
1. –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤ (–±—Ä–∞—É–∑–µ—Ä)
2. –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤ (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
3. –ö–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –æ—Ç–∑—ã–≤ (–∏–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É –Ω–∞ 5)
4. –ö–∞–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤
5. –ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –ø–æ –±—Ä–∞–∫—É
6. –ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –æ–±—ã—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
7. –ö–∞–∫ –º—ã –≤—ã–ø–ª–∞—á–∏–≤–∞–µ–º –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é

### UI: –í–∫–ª–∞–¥–∫–∞ AI

**–§–∞–π–ª:** `src/app/stores/[storeId]/ai/page.tsx`

–¢—Ä–∏ —Å–µ–∫—Ü–∏–∏:

| # | –°–µ–∫—Ü–∏—è | –î–∞–Ω–Ω—ã–µ | –•—Ä–∞–Ω–µ–Ω–∏–µ |
|---|--------|--------|----------|
| 1 | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ AI-–∞–≥–µ–Ω—Ç–∞ | –°–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç | `stores.ai_instructions` |
| 2 | FAQ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π | –í–æ–ø—Ä–æ—Å + –û—Ç–≤–µ—Ç –ø–∞—Ä—ã | `store_faq` —Ç–∞–±–ª–∏—Ü–∞ |
| 3 | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ | –ù–∞–∑–≤–∞–Ω–∏–µ + –ü–æ—à–∞–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç | `store_guides` —Ç–∞–±–ª–∏—Ü–∞ |

–ö–∞–∂–¥–∞—è —Å–µ–∫—Ü–∏—è –∏–º–µ–µ—Ç:
- CRUD (–¥–æ–±–∞–≤–∏—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª–∏—Ç—å)
- Toggle active/inactive
- Template picker —Å multi-select –∏ batch add
- –î–µ—Ç–µ–∫—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ("—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ")

**Prefetch:** `src/app/stores/[storeId]/layout.tsx` –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ—Ç `ai-instructions`, `store-faq`, `store-guides`

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### User Settings (—Ç–∞–±–ª–∏—Ü–∞ `user_settings`)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|------|----------|----------------|
| `prompt_chat_reply` | –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ | generate-chat-reply-flow |
| `prompt_chat_tag` | –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–µ–≥–æ–≤ | classify-chat-tag-flow |
| `prompt_chat_deletion_tag` | –ü—Ä–æ–º–ø—Ç –¥–ª—è deletion-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (fallback: prompt_chat_tag) | classify-chat-deletion-flow |
| `prompt_deletion_offer` | –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ deletion offer (fallback: prompt_chat_reply) | generate-deletion-offer-flow |
| `ai_concurrency` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å AI –∑–∞–ø—Ä–æ—Å–æ–≤ (default: 5) | Bulk operations |
| `deepseek_api_key` | API –∫–ª—é—á Deepseek (–µ—Å–ª–∏ —Å–≤–æ–π) | assistant-utils |
| `no_reply_messages` | –®–∞–±–ª–æ–Ω—ã –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∏ (–Ω–∞–±–æ—Ä 1: –Ω–µ–≥–∞—Ç–∏–≤ 1-2-3) | auto-sequence-templates |
| `no_reply_trigger_phrase` | –¢—Ä–∏–≥–≥–µ—Ä–Ω–∞—è —Ñ—Ä–∞–∑–∞ (–Ω–∞–±–æ—Ä 1) | dialogue sync trigger detection |
| `no_reply_stop_message` | –°—Ç–æ–ø-—Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–±–æ—Ä 1) | cron: sequence completion |
| `no_reply_messages2` | –®–∞–±–ª–æ–Ω—ã –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∏ (–Ω–∞–±–æ—Ä 2: 4 –∑–≤–µ–∑–¥—ã) | auto-sequence-templates |
| `no_reply_trigger_phrase2` | –¢—Ä–∏–≥–≥–µ—Ä–Ω–∞—è —Ñ—Ä–∞–∑–∞ (–Ω–∞–±–æ—Ä 2) | dialogue sync trigger detection |
| `no_reply_stop_message2` | –°—Ç–æ–ø-—Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–±–æ—Ä 2) | cron: sequence completion |

### Product Rules (—Ç–∞–±–ª–∏—Ü–∞ `product_rules`)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `work_in_chats` | –†–∞–±–æ—Ç–∞—Ç—å —Å —á–∞—Ç–∞–º–∏ –ø–æ —Ç–æ–≤–∞—Ä—É (–≤–∫–ª—é—á–∞–µ—Ç deletion workflow) |
| `offer_compensation` | –†–∞–∑—Ä–µ—à–µ–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é |
| `chat_strategy` | –°—Ç—Ä–∞—Ç–µ–≥–∏—è: `upgrade_to_5` / `delete` / `both` |
| `compensation_type` | –¢–∏–ø –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏: `cashback` / `refund` |
| `max_compensation` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ |

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### ai_logs —Ç–∞–±–ª–∏—Ü–∞

–í—Å–µ AI-–≤—ã–∑–æ–≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `runChatCompletion()`:

```sql
INSERT INTO ai_logs (
  store_id, owner_id,
  entity_type, entity_id, action,
  prompt, response,
  model, tokens_used, cost,
  created_at
) VALUES (...);
```

---

## –°–≤—è–∑—å —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è–º–∏ –∏ –∂–∞–ª–æ–±–∞–º–∏

### –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏

1. AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–∞—Ç –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç deletion-–∫–∞–Ω–¥–∏–¥–∞—Ç–∞
2. –ï—Å–ª–∏ `offer_compensation = true` –≤ product_rules:
   - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É (—Ä–µ–π—Ç–∏–Ω–≥ ‚Üí % –æ—Ç max_compensation)
   - AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –°–æ–∑–¥–∞—ë—Ç—Å—è `deletion_case` –≤ –ë–î
3. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí –∫–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
4. ROI: 600 —Ä—É–± –∑–∞ —É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

### –ñ–∞–ª–æ–±—ã

1. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ù–ï —Å–æ–≥–ª–∞—Å–∏–ª—Å—è —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤:
   - –ß–∞—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `completed`
   - –ñ–∞–ª–æ–±–∞ –æ—Å—Ç–∞—ë—Ç—Å—è/–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow
2. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–¥–∞–ª–∏–ª –æ—Ç–∑—ã–≤:
   - –ñ–∞–ª–æ–±–∞ –Ω–µ –Ω—É–∂–Ω–∞
   - –û—Ç–∑—ã–≤ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `review_status_wb = 'hidden'`

---

## –ê–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∞ (Auto-Sequence)

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ follow-up —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —á–∞—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ `awaiting_reply`.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ –Ω–∞–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–æ–≤** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ç–∑—ã–≤–æ–≤.

### –ù–∞–±–æ—Ä 1: –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã (1-2-3 –∑–≤–µ–∑–¥—ã)

**sequence_type:** `no_reply_followup`

**–°–¢–ê–†–¢-—Å–æ–æ–±—â–µ–Ω–∏–µ** (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º/AI –∫–ª–∏–µ–Ω—Ç—É):
```
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã
–ú—ã —É–≤–∏–¥–µ–ª–∏ –≤–∞—à –æ—Ç–∑—ã–≤ –∏ –æ—á–µ–Ω—å —Ö–æ—Ç–∏–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.
–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–∞—Å—Å—Ç—Ä–æ–∏–ª–æ: –∫–∞—á–µ—Å—Ç–≤–æ, —É–ø–∞–∫–æ–≤–∫–∞, –æ–∂–∏–¥–∞–Ω–∏—è, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏–ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë? üôè
```
**–ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞:** `–ú—ã —É–≤–∏–¥–µ–ª–∏ –≤–∞—à –æ—Ç–∑—ã–≤ –∏ –æ—á–µ–Ω—å —Ö–æ—Ç–∏–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è`
**–•—Ä–∞–Ω–µ–Ω–∏–µ:** `user_settings.no_reply_trigger_phrase` (–∏–ª–∏ `DEFAULT_TRIGGER_PHRASE`)

**–°–¢–û–ü-—Å–æ–æ–±—â–µ–Ω–∏–µ** (–ø–æ—Å–ª–µ 14 –¥–Ω–µ–π –±–µ–∑ –æ—Ç–≤–µ—Ç–∞):
```
–°–ø–∞—Å–∏–±–æ –≤–∞–º –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –∑–∞ —Ç–æ, —á—Ç–æ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ üôè
–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –º–Ω–æ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ —ç—Ç–æ–º—É —Ç–æ–≤–∞—Ä—É –∏ –ø–æ–Ω—è–ª–∏, –Ω–∞–¥ —á–µ–º –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å...
```
**–•—Ä–∞–Ω–µ–Ω–∏–µ:** `user_settings.no_reply_stop_message` (–∏–ª–∏ `DEFAULT_STOP_MESSAGE`)

**Follow-up —à–∞–±–ª–æ–Ω—ã (14 –¥–Ω–µ–π, 4 —Ñ–∞–∑—ã):**
- Day 1-3: –ú—è–≥–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
- Day 4-7: –£—Ç–æ—á–Ω–µ–Ω–∏–µ, –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- Day 8-11: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- Day 12-14: –§–∏–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º

### –ù–∞–±–æ—Ä 2: –û—Ç–∑—ã–≤—ã 4 –∑–≤–µ–∑–¥—ã

**sequence_type:** `no_reply_followup_4star`

**–°–¢–ê–†–¢-—Å–æ–æ–±—â–µ–Ω–∏–µ:** –û–∂–∏–¥–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–±—É–¥–µ—Ç –¥—Ä—É–≥–æ–µ, –Ω–µ –∫–∞–∫ –¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–∞)
**–ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞:** `user_settings.no_reply_trigger_phrase2` (–ø–æ–∫–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, –Ω–∞–±–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω)

**–°–¢–û–ü-—Å–æ–æ–±—â–µ–Ω–∏–µ** (–ø–æ—Å–ª–µ 14 –¥–Ω–µ–π –±–µ–∑ –æ—Ç–≤–µ—Ç–∞):
```
–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –æ—Ü–µ–Ω–∫—É –∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å! üôè
–ú—ã —Ä–∞–¥—ã, —á—Ç–æ —Ç–æ–≤–∞—Ä –≤–∞–º –≤ —Ü–µ–ª–æ–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è. –í–∞—à–∏ –∑–∞–º–µ—á–∞–Ω–∏—è –æ—á–µ–Ω—å —Ü–µ–Ω–Ω—ã –¥–ª—è –Ω–∞—Å...
```
**–•—Ä–∞–Ω–µ–Ω–∏–µ:** `user_settings.no_reply_stop_message2` (–∏–ª–∏ `DEFAULT_STOP_MESSAGE_4STAR`)

**Follow-up —à–∞–±–ª–æ–Ω—ã (14 –¥–Ω–µ–π, 4 —Ñ–∞–∑—ã):**
- Day 1-3: –£–∑–Ω–∞—ë–º, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ –¥–æ 5 –∑–≤—ë–∑–¥
- Day 4-7: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å/—É–ª—É—á—à–∏—Ç—å
- Day 8-11: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–º–æ—á—å
- Day 12-14: –§–∏–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

**–õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –Ω–∞–±–æ—Ä–∞:** –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–≤–ø–∞–ª–æ —Å `trigger_phrase` ‚Üí –Ω–∞–±–æ—Ä 1. –ï—Å–ª–∏ —Å `trigger_phrase2` ‚Üí –Ω–∞–±–æ—Ä 2. –ï—Å–ª–∏ —Å–æ–≤–ø–∞–ª–∏ –æ–±–∞ ‚Üí –Ω–∞–±–æ—Ä 1 (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç).

### –ü–æ–ª–Ω—ã–π flow

```
1. –ú–µ–Ω–µ–¥–∂–µ—Ä (–∏–ª–∏ AI) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –°–¢–ê–†–¢-—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
2. Dialogue sync –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—é —Ñ—Ä–∞–∑—É –≤ –Ω–æ–≤–æ–º seller-—Å–æ–æ–±—â–µ–Ω–∏–∏
3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–±–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ (–Ω–∞–±–æ—Ä 1 –∏–ª–∏ 2 –ø–æ trigger phrase)
4. ‚Üí tag = 'deletion_candidate', status = 'awaiting_reply'
5. ‚Üí –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∞ (14 follow-up, 1/–¥–µ–Ω—å) —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º sequence_type
6. Cron-job (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω, 8:00-22:00 MSK) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
7. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª ‚Üí —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
8. –ï—Å–ª–∏ 14 –¥–Ω–µ–π –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ ‚Üí –°–¢–û–ü-—Å–æ–æ–±—â–µ–Ω–∏–µ (–ø–æ sequence_type) + status = 'closed' (no_reply)
```

### –°—Ç–æ–ø-—É—Å–ª–æ–≤–∏—è

| –£—Å–ª–æ–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| –ö–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª | Sequence stopped (`client_replied`) |
| –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω (–Ω–µ `awaiting_reply`) | Sequence stopped (`manual`) |
| 14 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ | –°–¢–û–ü-—Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–±–æ—Ä 1 –∏–ª–∏ 2) + chat closed (`no_reply`) |

**–¢–∞–±–ª–∏—Ü–∞:** `chat_auto_sequences` (–ø–æ–ª–µ `sequence_type` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–±–æ—Ä)
**–®–∞–±–ª–æ–Ω—ã:** `src/lib/auto-sequence-templates.ts` (–¥–µ—Ñ–æ–ª—Ç—ã) –∏–ª–∏ `user_settings` (–∫–∞—Å—Ç–æ–º–Ω—ã–µ)
**Cron job:** `startAutoSequenceProcessor` –≤ `src/lib/cron-jobs.ts`
**Trigger detection:** `src/app/api/stores/[storeId]/dialogues/update/route.ts` (Step 5b)

---

## –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –°—Ç–∞—Ç—É—Å | –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è |
|------------|--------|---------------|
| autoSend –¥–ª—è deletion offers | TODO –≤ –∫–æ–¥–µ | generate-deletion-offer route, —Å—Ç—Ä–æ–∫–∞ ~254 |
| Messenger View (split-screen) | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω | - |
| –†–µ–∂–∏–º—ã AI (auto/supervised) | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | - |
| ~~–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞–±–∏–Ω–µ—Ç–∞–º~~ | **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (2026-02-10)** | `stores.ai_instructions` + `store_faq` + `store_guides` |

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —á–∞—Ç–æ–≤](../product-specs/CHATS_FEATURE_SPEC.md)
- [Kanban Board](../product-specs/KANBAN_BOARD_IMPLEMENTATION.md)
- [–õ–æ–≥–∏–∫–∞ –∂–∞–ª–æ–±](./complaints.md)
- [–°—Ç–∞—Ç—É—Å—ã (reference)](../reference/statuses-reference.md)
- [Database Schema](../database-schema.md)

---

**Last Updated:** 2026-02-10
