# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ß–∞—Ç—ã

**–î–∞—Ç–∞:** 2026-01-16
**–í–µ—Ä—Å–∏—è:** 1.0
**–ê–≤—Ç–æ—Ä:** Product Team

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [User Stories](#user-stories)
2. [–§–∏—á–∏ MVP](#—Ñ–∏—á–∏-mvp)
3. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
4. [–ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
5. [API Specifications](#api-specifications)
6. [Data Models](#data-models)
7. [Edge Cases](#edge-cases)
8. [Testing Strategy](#testing-strategy)

---

## User Stories

### –ü–µ—Ä—Å–æ–Ω—ã (Personas)

**1. –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–ú–∞—Ä–∏—è, 28 –ª–µ—Ç)**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 50-80 —á–∞—Ç–æ–≤ –≤ –¥–µ–Ω—å
- –†–∞–±–æ—Ç–∞–µ—Ç —Å 9:00 –¥–æ 18:00
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ—É—Ç–±—É–∫ (1920x1080)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞

**2. –°—Ç–∞—Ä—à–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä (–ê–ª–µ–∫—Å–µ–π, 35 –ª–µ—Ç)**
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥—ã
- –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∫–∞—á–µ—Å—Ç–≤–æ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**3. –í–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞ (–ò–≤–∞–Ω, 42 –≥–æ–¥–∞)**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–∞—Ç—ã
- –ù–µ –∏–º–µ–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–æ–ª–≥–∏–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–ª–∞–Ω—à–µ—Ç + –∫–æ–º–ø—å—é—Ç–µ—Ä
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

---

### Epic 1: –†–µ–∂–∏–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**US-001: –ü—Ä–æ—Å–º–æ—Ç—Ä —á–∞—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –∏ –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –Ω–∞ –æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ,
> **–ß—Ç–æ–±—ã** –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –¥–∏–∞–ª–æ–≥–∞–º–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**Acceptance Criteria:**
- [ ] –≠–∫—Ä–∞–Ω —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ 2 –ø–∞–Ω–µ–ª–∏: —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (30%) + –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç (70%)
- [ ] –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —Å –ø—Ä–µ–≤—å—é –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞
- [ ] –ö–ª–∏–∫ –Ω–∞ —á–∞—Ç –≤ —Å–ø–∏—Å–∫–µ ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–ø—Ä–∞–≤–∞
- [ ] –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≤—ã–¥–µ–ª–µ–Ω –≥–æ–ª—É–±—ã–º –±–æ—Ä–¥–µ—Ä–æ–º
- [ ] Scroll –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –¥–ª—è –æ–±–µ–∏—Ö –ø–∞–Ω–µ–ª–µ–π

**Priority:** P0 (Must Have)
**Effort:** 5 Story Points

---

**US-002: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ Table/Messenger**
> **–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
> **–Ø —Ö–æ—á—É** –≤—ã–±–∏—Ä–∞—Ç—å —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä),
> **–ß—Ç–æ–±—ã** —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —É–¥–æ–±–Ω–æ–º –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ —Ñ–æ—Ä–º–∞—Ç–µ

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –≤ —à–∞–ø–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Tabs –∏–ª–∏ Dropdown)
- [ ] –í—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- [ ] –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∏–∑ Table ‚Üí Messenger: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
- [ ] –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∏–∑ Messenger ‚Üí Table: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- [ ] –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- [ ] –ê–Ω–∏–º–∞—Ü–∏—è fade-in/fade-out –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ (300ms)

**Priority:** P0 (Must Have)
**Effort:** 3 Story Points

---

### Epic 2: AI-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

**US-003: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ AI**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI" –∏ –ø–æ–ª—É—á–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç,
> **–ß—Ç–æ–±—ã** –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –Ω–∞–±–æ—Ä —Ç–∏–ø–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ "ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI" –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ: loading state + –≤—ã–∑–æ–≤ `generateChatReply()` flow
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ AI Suggestion Box –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞
- [ ] –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI: –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ + –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ + –ø—Ä–æ–º–ø—Ç –∏–∑ settings
- [ ] –û—à–∏–±–∫–∞ AI ‚Üí toast —Å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: storeId, ownerId, chatId, tokens, cost

**Priority:** P0 (Must Have)
**Effort:** 8 Story Points

---

**US-004: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI –æ—Ç–≤–µ—Ç,
> **–ß—Ç–æ–±—ã** –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –≤ AI Suggestion Box
- [ ] –ö–ª–∏–∫ ‚Üí —Ç–µ–∫—Å—Ç –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ Textarea (editable)
- [ ] –ö–Ω–æ–ø–∫–∏ "‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –∏ "‚ùå –û—Ç–º–µ–Ω–∞"
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ AI Suggestion Box
- [ ] –û—Ç–º–µ–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π AI —Ç–µ–∫—Å—Ç
- [ ] Keyboard: Enter —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, Esc –æ—Ç–º–µ–Ω—è–µ—Ç

**Priority:** P0 (Must Have)
**Effort:** 3 Story Points

---

**US-005: –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI –æ—Ç–≤–µ—Ç–∞**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç,
> **–ß—Ç–æ–±—ã** –ø–æ–ª—É—á–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ "üîÑ –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –≤ AI Suggestion Box
- [ ] –ö–ª–∏–∫ ‚Üí –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- [ ] Loading state + –ø–ª–∞–≤–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ç–µ–∫—Å—Ç–∞
- [ ] –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)

**Priority:** P1 (Should Have)
**Effort:** 2 Story Points

---

**US-006: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å AI –æ—Ç–≤–µ—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞,
> **–ß—Ç–æ–±—ã** –±—ã—Å—Ç—Ä–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å" (–∏–ª–∏ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ AI —Ç–µ–∫—Å—Ç)
- [ ] –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ AI Suggestion Box –≤ Textarea
- [ ] Textarea –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ú–æ–∂–Ω–æ –µ—â—ë –ø–æ–¥—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- [ ] Hotkey: Ctrl+U (Use AI)

**Priority:** P0 (Must Have)
**Effort:** 2 Story Points

---

### Epic 3: –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ

**US-007: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–∞—Ç–æ–≤ –ø–æ —Ç–µ–≥–∞–º**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–∞—Ç—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (–ê–∫—Ç–∏–≤–Ω—ã–µ, –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏ —Ç–¥),
> **–ß—Ç–æ–±—ã** –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —á–∞—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –º–æ–µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è

**Acceptance Criteria:**
- [ ] Checkbox-—Ñ–∏–ª—å—Ç—Ä—ã –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏: –ê–∫—Ç–∏–≤–Ω—ã–µ, –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞, –£—Å–ø–µ—à–Ω—ã–µ, –ù–µ—É—Å–ø–µ—à–Ω—ã–µ
- [ ] –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- [ ] –°—á—ë—Ç—á–∏–∫ —Ä—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
- [ ] –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage

**Priority:** P0 (Must Have)
**Effort:** 3 Story Points

---

**US-008: –ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç—É/—Ç–æ–≤–∞—Ä—É**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –∏—Å–∫–∞—Ç—å —á–∞—Ç—ã –ø–æ –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é —Ç–æ–≤–∞—Ä–∞,
> **–ß—Ç–æ–±—ã** –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ª–æ–≥

**Acceptance Criteria:**
- [ ] –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
- [ ] Placeholder: "–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–æ–≤–∞—Ä—É..."
- [ ] Debounce 300ms
- [ ] –ü–æ–∏—Å–∫ –ø–æ: client_name, product_name, last_message_text
- [ ] Case-insensitive
- [ ] –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ ‚Üí –∫–Ω–æ–ø–∫–∞ [X] –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ

**Priority:** P1 (Should Have)
**Effort:** 2 Story Points

---

### Epic 4: –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ –∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**US-009: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É**, —á—Ç–æ–±—ã –º–æ–π –Ω–∞–±—Ä–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏,
> **–ß—Ç–æ–±—ã** –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –µ–≥–æ –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏

**Acceptance Criteria:**
- [ ] –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –≤ `draft_reply` (debounced)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì" / "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."
- [ ] –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞: –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –∏–∑ –ë–î
- [ ] –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

**Priority:** P1 (Should Have)
**Effort:** 3 Story Points

---

### Epic 5: Keyboard Shortcuts

**US-010: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã**
> **–ö–∞–∫** –æ–ø—ã—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏,
> **–ß—Ç–æ–±—ã** —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –±–µ–∑ –º—ã—à–∏

**Acceptance Criteria:**
- [ ] `Enter` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ñ–æ–∫—É—Å –≤ Textarea)
- [ ] `Shift+Enter` ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
- [ ] `Ctrl+E` ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ AI suggestion –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] `Ctrl+U` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI –æ—Ç–≤–µ—Ç
- [ ] `Ctrl+G` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI –æ—Ç–≤–µ—Ç
- [ ] `Esc` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –≤–≤–æ–¥–∞ / –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Hint –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã: "üí° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: Enter ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, Ctrl+G ‚Äî AI"

**Priority:** P2 (Could Have)
**Effort:** 2 Story Points

---

### Epic 6: UI/UX —É–ª—É—á—à–µ–Ω–∏—è

**US-011: –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –≤–∏–¥–µ—Ç—å, –≤ –∫–∞–∫–∏—Ö —á–∞—Ç–∞—Ö –µ—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è,
> **–ß—Ç–æ–±—ã** –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã

**Acceptance Criteria:**
- [ ] –ö—Ä–∞—Å–Ω–∞—è —Ç–æ—á–∫–∞ üî¥ —Å–ª–µ–≤–∞ –æ—Ç –∞–≤–∞—Ç–∞—Ä–∞ = –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π —á–∞—Ç
- [ ] Bold —à—Ä–∏—Ñ—Ç –¥–ª—è last_message_text —É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- [ ] –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ ‚Üí —Ç–æ—á–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç (mark as read)
- [ ] –°—á—ë—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –≤ —à–∞–ø–∫–µ: "üí¨ –ß–∞—Ç—ã (5 –Ω–æ–≤—ã—Ö)"

**Priority:** P2 (Could Have)
**Effort:** 3 Story Points

---

**US-012: –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Ç–µ–≥–∞ —á–∞—Ç–∞**
> **–ö–∞–∫** –º–µ–Ω–µ–¥–∂–µ—Ä,
> **–Ø —Ö–æ—á—É** –º–µ–Ω—è—Ç—å —Ç–µ–≥ —á–∞—Ç–∞ –ø—Ä—è–º–æ –∏–∑ —à–∞–ø–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞,
> **–ß—Ç–æ–±—ã** –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

**Acceptance Criteria:**
- [ ] Dropdown –≤ —à–∞–ø–∫–µ —á–∞—Ç–∞: [–¢–µ–≥ ‚ñº]
- [ ] –û–ø—Ü–∏–∏: –ê–∫—Ç–∏–≤–Ω—ã–π, –£—Å–ø–µ—à–Ω—ã–π, –ù–µ—É—Å–ø–µ—à–Ω—ã–π, –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞, –ë–µ–∑ —Ç–µ–≥–∞
- [ ] PUT –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/stores/[storeId]/chats/[chatId]`
- [ ] –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI + toast "–¢–µ–≥ –æ–±–Ω–æ–≤–ª—ë–Ω"
- [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è badge –∏ —Å—á—ë—Ç—á–∏–∫ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

**Priority:** P1 (Should Have)
**Effort:** 2 Story Points

---

## –§–∏—á–∏ MVP

### Must Have (P0) ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

1. ‚úÖ **Messenger View Layout** ‚Äî split-view (—Å–ø–∏—Å–æ–∫ + —á–∞—Ç)
2. ‚úÖ **AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî –∫–Ω–æ–ø–∫–∞ + –≤—ã–∑–æ–≤ API
3. ‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞** ‚Äî textarea edit mode
4. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞** ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
5. ‚úÖ **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤** ‚Äî Table ‚Üî Messenger
6. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–≥–∞–º** ‚Äî checkbox filters
7. ‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WB API

### Should Have (P1) ‚Äî –í–∞–∂–Ω—ã–µ –¥–ª—è UX

8. ‚úÖ **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
9. ‚úÖ **–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤** ‚Äî –ø–æ –∫–ª–∏–µ–Ω—Ç—É/—Ç–æ–≤–∞—Ä—É
10. ‚úÖ **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤** ‚Äî –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
11. ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Ç–µ–≥–∞** ‚Äî dropdown –≤ —à–∞–ø–∫–µ

### Could Have (P2) ‚Äî –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ

12. ‚è≥ **Keyboard shortcuts** ‚Äî Enter, Ctrl+E, Ctrl+G
13. ‚è≥ **–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Ç—ã** ‚Äî –∫—Ä–∞—Å–Ω–∞—è —Ç–æ—á–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
14. ‚è≥ **Bulk AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ API

### Won't Have ‚Äî –ù–µ –≤ MVP

15. ‚ùå **Real-time updates** ‚Äî WebSocket
16. ‚ùå **–ì—Ä—É–ø–ø–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞** ‚Äî assignment —á–∞—Ç–æ–≤
17. ‚ùå **–®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî –±—ã—Å—Ç—Ä—ã–µ —Ñ—Ä–∞–∑—ã
18. ‚ùå **Voice messages** ‚Äî –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### FR-001: –†–µ–∂–∏–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —á–∞—Ç—ã –≤ split-view —Ä–µ–∂–∏–º–µ

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- Store ID (–∏–∑ URL)
- –§–∏–ª—å—Ç—Ä—ã (tags, search)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (–ª–µ–≤–∞—è –ø–∞–Ω–µ–ª—å)
- –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞ (–ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å)

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
   - Fetch —á–∞—Ç—ã: `GET /api/stores/[storeId]/chats?skip=0&take=100`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ localStorage
   - –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ (–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π)
   - Fetch –∏—Å—Ç–æ—Ä–∏—é: `GET /api/stores/[storeId]/chats/[chatId]`
2. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —á–∞—Ç:
   - Fetch –∏—Å—Ç–æ—Ä–∏—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
   - –û–±–Ω–æ–≤–∏—Ç—å activeChat state
   - –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
3. –ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞:
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π —á–∞—Ç –∏–∑ –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- Store ID –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ë–î
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∞–≥–∞–∑–∏–Ω—É

---

### FR-002: AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é AI

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- Chat ID
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
- –ü—Ä–æ–º–ø—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
- –ú–µ—Ç—Ä–∏–∫–∏: tokens, cost, duration

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI"
2. –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç:
   ```
   –ú–∞–≥–∞–∑–∏–Ω: [store_name]
   –¢–æ–≤–∞—Ä: [product_name] (WB: [product_nm_id])

   –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞:
   [–ö–ª–∏–µ–Ω—Ç]: [message_text]
   [–ü—Ä–æ–¥–∞–≤–µ—Ü]: [message_text]
   ...
   ```
3. –í—ã–∑–≤–∞—Ç—å `generateChatReply({ context, storeId, ownerId, chatId })`
4. Deepseek API –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–æ–º–ø—Ç–æ–º –∏–∑ `settings.prompt_chat_reply`
5. –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `ai_logs`
7. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤ AI Suggestion Box

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- API timeout (30s) ‚Üí toast "AI –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑"
- Invalid response ‚Üí toast "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ AI"
- Deepseek API error ‚Üí toast —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ß–∞—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –ø—É—Å—Ç–∞—è (–º–∏–Ω–∏–º—É–º 1 —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞)

---

### FR-003: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI —Ç–µ–∫—Å—Ç

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI —Ç–µ–∫—Å—Ç

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ö–ª–∏–∫ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" ‚Üí –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ Textarea
2. Textarea –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ AI —Ç–µ–∫—Å—Ç–æ–º
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ö–ª–∏–∫ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å AI Suggestion Box
5. –ö–ª–∏–∫ "–û—Ç–º–µ–Ω–∞" ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π AI —Ç–µ–∫—Å—Ç

**Keyboard:**
- Enter ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
- Esc ‚Üí –æ—Ç–º–µ–Ω–∞

---

### FR-004: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–∞—Ç–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–∞—Ç—ã –ø–æ —Ç–µ–≥–∞–º

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏ (array: ['active', 'no_reply'])

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ß–µ–∫–±–æ–∫—Å –∫–ª–∏–∫ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å —Ç–µ–≥ –∏–∑ –º–∞—Å—Å–∏–≤–∞
2. API –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `tag`:
   - –ï—Å–ª–∏ 1 —Ç–µ–≥: `tag=active`
   - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ: –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (fetch –≤—Å–µ, —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
3. –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
4. –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
- localStorage: `messengerFilters: { tags: [...] }`

---

### FR-005: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- Chat ID
- Draft text

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ `chats.draft_reply`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. onChange –≤ Textarea ‚Üí debounce 2000ms
2. PUT `/api/stores/[storeId]/chats/[chatId]` —Å `{ draft_reply: text }`
3. –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì"
4. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫:
   ```typescript
   await updateChat(chatId, { draft_reply: null })
   ```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç < 3 —Å–∏–º–≤–æ–ª–æ–≤
- –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É

---

## –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### NFR-001: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤: < 500ms
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞: < 300ms
- AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞: < 5s (95 –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å)
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (< 100ms)

**–ú–µ—Ç—Ä–∏–∫–∏:**
- React Query cache hit rate: > 80%
- Database query time: < 100ms

---

### NFR-002: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 1000 —á–∞—Ç–æ–≤ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 10,000 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
- Pagination –¥–ª—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ (lazy loading)

---

### NFR-003: Usability

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π UI (–≤—Ä–µ–º—è –æ—Å–≤–æ–µ–Ω–∏—è < 5 –º–∏–Ω—É—Ç)
- Responsive design (desktop 1024px+, tablet 768px+, mobile 375px+)
- Keyboard navigation –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- Accessibility (WCAG 2.1 AA)

---

### NFR-004: –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Uptime: 99.9%
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö)
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö AI
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è failed API calls

---

### NFR-005: Security

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Authorization: –ø—Ä–æ–≤–µ—Ä–∫–∞ access –∫ store —á–µ—Ä–µ–∑ API key
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (XSS protection)
- Rate limiting –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (10 requests/min per user)

---

## API Specifications

### –ù–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ endpoints

#### POST `/api/stores/[storeId]/chats/[chatId]/generate-reply`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —á–∞—Ç–∞

**Request:**
```json
{
  "includeContext": true,  // –í–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é + —Ç–æ–≤–∞—Ä
  "maxTokens": 500
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –í–∞—à –∑–∞–∫–∞–∑...",
    "tokens": {
      "prompt": 250,
      "completion": 120,
      "total": 370
    },
    "cost": 0.00015,
    "duration": 2450
  }
}
```

**Errors:**
- 400: Chat not found
- 500: AI generation failed
- 429: Rate limit exceeded

---

#### PUT `/api/stores/[storeId]/chats/[chatId]`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ (—Ç–µ–≥, —á–µ—Ä–Ω–æ–≤–∏–∫)

**Request:**
```json
{
  "tag": "active",          // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "draft_reply": "–¢–µ–∫—Å—Ç"    // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "chat": { /* updated chat */ }
  }
}
```

---

## Data Models

### Chat (extended)

```typescript
interface Chat {
  id: string;
  store_id: string;
  owner_id: string;

  // –ö–ª–∏–µ–Ω—Ç
  client_name: string;
  reply_sign: string;

  // –¢–æ–≤–∞—Ä
  product_nm_id?: string;
  product_name?: string;
  product_vendor_code?: string;

  // –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  last_message_date?: string;
  last_message_text?: string;
  last_message_sender?: 'client' | 'seller';

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  tag: ChatTag;
  draft_reply?: string;
  draft_reply_thread_id?: string;

  // UI state (–∫–ª–∏–µ–Ω—Ç)
  isUnread?: boolean;        // –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  isActive?: boolean;        // –í—ã–±—Ä–∞–Ω –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ
}
```

### AISuggestion (–Ω–æ–≤—ã–π —Ç–∏–ø)

```typescript
interface AISuggestion {
  chatId: string;
  text: string;
  tokens: {
    prompt: number;
    completion: number;
    total: number;
  };
  cost: number;
  duration: number;
  createdAt: string;
}
```

---

## Edge Cases

### EC-001: –ü—É—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–∞—Ç –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω –≤ WB)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑–∞—Ç—å placeholder: "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π"
- –ö–Ω–æ–ø–∫–∞ "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI" disabled
- –ü–æ–¥—Å–∫–∞–∑–∫–∞: "–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞"

---

### EC-002: AI –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** Deepseek API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ quota exceeded

**–†–µ—à–µ–Ω–∏–µ:**
- Toast: "AI –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç –≤—Ä—É—á–Ω—É—é"
- –ö–Ω–æ–ø–∫–∞ "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI" ‚Üí disabled –Ω–∞ 1 –º–∏–Ω—É—Ç—É
- Fallback: –ø–æ–∫–∞–∑–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

---

### EC-003: –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–∞—Ç —Å 500+ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è AI: –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π (context window limit)
- UI: lazy loading –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–≤–µ—Ä—Ö (load more messages)
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä: "–ü–æ–∫–∞–∑–∞–Ω–æ 50 –∏–∑ 500 —Å–æ–æ–±—â–µ–Ω–∏–π. –°–∫—Ä–æ–ª–ª–∏—Ç–µ –≤–≤–µ—Ä—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏"

---

### EC-004: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ—Ç–∫—Ä—ã–ª–∏ –æ–¥–∏–Ω —á–∞—Ç

**–†–µ—à–µ–Ω–∏–µ (MVP):**
- Last write wins (–±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- –í –±—É–¥—É—â–µ–º: WebSocket –¥–ª—è real-time sync

---

### EC-005: –§–∏–ª—å—Ç—Ä—ã –Ω–µ –¥–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã ‚Üí 0 —á–∞—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑–∞—Ç—å empty state:
  ```
  üîç –ß–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
  –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
  [–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã]
  ```

---

## Testing Strategy

### Unit Tests

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ChatListItem ‚Äî render, click, hover
- MessageBubble ‚Äî sender styling, timestamp
- AISuggestionBox ‚Äî edit mode, regenerate
- MessageComposer ‚Äî autosave, hotkeys

**Utils:**
- formatRelativeTime()
- getClientInitials()
- canUseTemplate() (–¥–ª—è –ø—É—Å—Ç—ã—Ö –æ—Ç–∑—ã–≤–æ–≤)

### Integration Tests

**API Routes:**
- GET `/api/stores/[storeId]/chats` ‚Äî pagination, filters
- POST `/api/stores/[storeId]/chats/[chatId]/generate-reply` ‚Äî AI call
- PUT `/api/stores/[storeId]/chats/[chatId]` ‚Äî update tag/draft

**Flows:**
- generateChatReply() ‚Äî mock Deepseek API
- classifyChatTag() ‚Äî mock Deepseek API

### E2E Tests (Playwright)

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å Messenger View ‚Üí –≤–∏–¥–Ω–æ —Å–ø–∏—Å–æ–∫ + —á–∞—Ç
2. –ö–ª–∏–∫ –Ω–∞ —á–∞—Ç ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI ‚Üí –ø–æ—è–≤–ª–µ–Ω–∏–µ –≤ AI Suggestion Box
4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
5. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
6. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞

### Performance Tests

**–ú–µ—Ç—Ä–∏–∫–∏:**
- Lighthouse score > 90
- Time to Interactive < 2s
- First Contentful Paint < 1s

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Feature Spec —Å–æ–∑–¥–∞–Ω–∞
2. üîÑ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
3. ‚è≥ Implementation Roadmap
4. ‚è≥ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Å–ø—Ä–∏–Ω—Ç–∞–º

---

**–í–æ–ø—Ä–æ—Å—ã:**
- –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ emoji picker –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞?
- –î–æ–ª–∂–Ω–∞ –ª–∏ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤? (WB API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç?)
- –õ–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –¥–µ–Ω—å?

**GitHub:** [Klimov-IS/R5-Saas-v-2.0](https://github.com/Klimov-IS/R5-Saas-v-2.0)
