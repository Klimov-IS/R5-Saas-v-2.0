# TASK-004: Complaints Generation Audit Report

**Ğ”Ğ°Ñ‚Ğ°:** 2026-02-08
**ĞĞ²Ñ‚Ğ¾Ñ€:** Claude Code (Product Analyst)
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½

---

## 1. Executive Summary

### Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾

ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ñ‘Ğ½ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¶Ğ°Ğ»Ğ¾Ğ± R5 SAAS. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚:

- **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¶Ğ°Ğ»Ğ¾Ğ±** Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² 1-4â˜… Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
- **AI-Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** Ñ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸ĞµĞ¹ 30-50% Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² (Deepseek)
- **Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ğ½ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ** Ğ´Ğ»Ñ Ğ¿ÑƒÑÑ‚Ñ‹Ñ… Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² (zero AI cost)
- **CRON fallback** Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ…Ğ²Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ñ… Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²** (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ 2026-02-03)

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´ĞºĞ¸

| ĞÑĞ¿ĞµĞºÑ‚ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ |
|--------|--------|-------------|
| Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½ | Truncation Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ¾Ñ‡ĞºĞ°Ñ… ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ |
| Event-driven Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | Ğ”Ğ¾ 100 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾, >100 â†’ CRON |
| CRON fallback | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 50 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²/Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½/Ñ‡Ğ°Ñ |
| Auto Backfill | âœ… **Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ’ĞĞ** | ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° |
| Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹ >1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² | âœ… ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ | 0 Ğ¶Ğ°Ğ»Ğ¾Ğ± Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ |

### Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ (2026-02-08)

1. âœ… **Auto Backfill System** â€” Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
   - Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (work_status â†’ 'active')
   - ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ñ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ°Ğ¼Ğ¸
   - Ğ”Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 2000 Ğ¶Ğ°Ğ»Ğ¾Ğ±/Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½
   - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ
   - CRON worker ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - API Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ

---

## 2. Current State â€” ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑĞµĞ¹Ñ‡Ğ°Ñ

### 2.1 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TRIGGER POINTS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Event-Driven          2. CRON Fallback         3. Manual UI     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ğ·Ñ‹Ğ² ÑĞ¸Ğ½Ğº       â€¢ ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ (prod)     â€¢ ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ² UI    â”‚
â”‚  â€¢ ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°       â€¢ ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ (test)   â€¢ Batch selection â”‚
â”‚  â€¢ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»       â€¢ Ğ”Ğ¾ 50 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²/Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½ â€¢ Regenerate      â”‚
â”‚  â€¢ Ğ”Ğ¾ 100 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²         â”‚                       â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GENERATION FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. shouldGenerateComplaint() â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»              â”‚
â”‚     â”œâ”€â”€ Rating 1-4 (Ğ½Ğµ 5â˜…)                                          â”‚
â”‚     â”œâ”€â”€ Date >= 2023-10-01 (WB cutoff)                              â”‚
â”‚     â”œâ”€â”€ Store is_active = true                                       â”‚
â”‚     â”œâ”€â”€ Product is_active = true                                     â”‚
â”‚     â”œâ”€â”€ ProductRule.submit_complaints = true                         â”‚
â”‚     â”œâ”€â”€ ProductRule.complaint_rating_N = true                        â”‚
â”‚     â””â”€â”€ No existing complaint (idempotency)                          â”‚
â”‚                                                                      â”‚
â”‚  2. generateReviewComplaint() â€” AI/Template                          â”‚
â”‚     â”œâ”€â”€ canUseTemplate() â†’ TEMPLATE (zero cost)                      â”‚
â”‚     â”‚   â””â”€â”€ Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ: Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¾Ñ‚Ğ·Ñ‹Ğ² + rating 1-3                       â”‚
â”‚     â””â”€â”€ runChatCompletion() â†’ DEEPSEEK AI                            â”‚
â”‚         â””â”€â”€ buildOptimizedSystemPrompt() + fashion addendum          â”‚
â”‚                                                                      â”‚
â”‚  3. truncateComplaintText() â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²                â”‚
â”‚     â”œâ”€â”€ ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ (. ! ?)                        â”‚
â”‚     â”œâ”€â”€ Fallback: Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ»Ğ¾Ğ²Ğ¾                                    â”‚
â”‚     â””â”€â”€ Hard truncate                                                â”‚
â”‚                                                                      â”‚
â”‚  4. createComplaint() / bulkCreateComplaints() â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¶Ğ°Ğ»Ğ¾Ğ±

#### A. Event-Driven (ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ)

**Ğ¤Ğ°Ğ¹Ğ»:** [auto-complaint-generator.ts](src/services/auto-complaint-generator.ts)

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹:**
1. ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ğ·Ñ‹Ğ² ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ WB API
2. ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (is_active: false â†’ true)
3. Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (is_active: false â†’ true)
4. ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹ (submit_complaints Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½)

**ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ:**
- `MAX_EVENT_DRIVEN_BATCH = 100` â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞµ â†’ Ğ¾Ñ‚ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° CRON
- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `/api/extension/stores/{storeId}/reviews/generate-complaints-batch`

#### B. CRON Fallback (ĞŸĞ¾Ñ‡Ğ°ÑĞ¾Ğ²Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ)

**Ğ¤Ğ°Ğ¹Ğ»:** [cron-jobs.ts](src/lib/cron-jobs.ts)

**Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:**
- Production: `0 * * * *` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ)
- Testing: `*/5 * * * *` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ñ‹
2. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°:
   - Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹ (incremental)
   - ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹ Ğ‘Ğ•Ğ— Ğ¶Ğ°Ğ»Ğ¾Ğ± (max 50)
   - Ğ’Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ batch generation API

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ 50 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²/Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½/Ñ‡Ğ°Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡ĞµĞ½ Ğ´Ğ»Ñ backfill.

#### C. Manual UI (Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ)

**Ğ¤Ğ°Ğ¹Ğ»:** [reviews/page.tsx](src/app/stores/[storeId]/reviews/page.tsx)

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»:**
- Bulk selection Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²
- ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹"
- Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹: Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³, ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹, ÑÑ‚Ğ°Ñ‚ÑƒÑ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°, ÑÑ‚Ğ°Ñ‚ÑƒÑ WB

### 2.3 Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ°

#### AI Generation (Deepseek)

**Ğ¤Ğ°Ğ¹Ğ»:** [generate-review-complaint-flow.ts](src/ai/flows/generate-review-complaint-flow.ts)

**ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚:** [optimized-review-complaint-prompt.ts](src/ai/prompts/optimized-review-complaint-prompt.ts)

**Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğµ:**
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°, Ğ°Ñ€Ñ‚Ğ¸ĞºÑƒĞ»
- Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
- Ğ¢ĞµĞºÑÑ‚ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°, Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¸Ğ½ÑÑ‚Ğ²Ğ°, Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸
- Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³, Ğ´Ğ°Ñ‚Ğ°, Ğ°Ğ²Ñ‚Ğ¾Ñ€
- Fashion addendum (Ğ´Ğ»Ñ Ğ¾Ğ´ĞµĞ¶Ğ´Ñ‹)

**ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¶Ğ°Ğ»Ğ¾Ğ± WB (11-20):**
| ID | ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ |
|----|----------|
| 11 | ĞÑ‚Ğ·Ñ‹Ğ² Ğ½Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ÑÑ Ğº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ |
| 12 | ĞÑ‚Ğ·Ñ‹Ğ² Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ñ‹ |
| 13 | Ğ¡Ğ¿Ğ°Ğ¼-Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ° Ğ² Ñ‚ĞµĞºÑÑ‚Ğµ |
| 14 | Ğ¡Ğ¿Ğ°Ğ¼-Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ° Ğ² Ñ„Ğ¾Ñ‚Ğ¾ |
| 15 | ĞĞµÑ†ĞµĞ½Ğ·ÑƒÑ€Ğ½Ğ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ |
| 16 | ĞĞµÑ†ĞµĞ½Ğ·ÑƒÑ€Ğ½Ğ°Ñ Ğ»ĞµĞºÑĞ¸ĞºĞ°, ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹ |
| 17 | Ğ¤Ğ¾Ñ‚Ğ¾ Ğ½Ğµ Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğµ |
| 18 | ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ |
| 19 | Ğ’Ñ€ĞµĞ´Ğ¾Ğ½Ğ¾ÑĞ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ |
| 20 | Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ |

#### Template Generation (Zero Cost)

**Ğ¤Ğ°Ğ¹Ğ»:** [complaint-templates.ts](src/ai/utils/complaint-templates.ts)

**Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
- ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°
- ĞŸÑƒÑÑ‚Ñ‹Ğµ Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¸Ğ½ÑÑ‚Ğ²Ğ°
- ĞŸÑƒÑÑ‚Ñ‹Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸
- Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ 1-3â˜…

**A/B Testing:** 4 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ñ hash-based rotation.

### 2.4 Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

**Ğ¤Ğ°Ğ¹Ğ»:** [complaint-text-validator.ts](src/ai/utils/complaint-text-validator.ts)

**ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹:**
- `COMPLAINT_HARD_LIMIT = 1000` â€” Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ WB
- `COMPLAINT_SOFT_LIMIT = 800` â€” Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:**
| Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|---------|------|--------|
| `generateReviewComplaint()` | generate-review-complaint-flow.ts | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ |
| `createComplaint()` | complaint-helpers.ts | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ |
| `updateComplaint()` | complaint-helpers.ts | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ |
| `regenerateComplaint()` | complaint-helpers.ts | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ |
| `bulkCreateComplaints()` | complaint-helpers.ts | âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ |

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ truncation:**
1. Ğ•ÑĞ»Ğ¸ Ñ‚ĞµĞºÑÑ‚ <= 1000 â†’ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ
2. Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ (`. `, `! `, `? `)
3. Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¸ Ğ¿Ğ¾ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ >70% â†’ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°ĞµĞ¼ Ğ¿Ğ¾ Ğ½ĞµĞ¼Ñƒ
4. Fallback: Ğ¸Ñ‰ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» (>80%)
5. Hard fallback: Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°ĞµĞ¼

### 2.5 Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹ Ğ¶Ğ°Ğ»Ğ¾Ğ±

```
draft â†’ pending â†’ approved
                â†’ rejected â†’ reconsidered
```

| Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Editable |
|--------|----------|----------|
| `draft` | Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº | âœ… Ğ”Ğ° |
| `pending` | ĞĞ° Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ¸Ğ¸ WB | âŒ ĞĞµÑ‚ |
| `approved` | ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ° WB | âŒ ĞĞµÑ‚ |
| `rejected` | ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ° WB | âŒ ĞĞµÑ‚ |
| `reconsidered` | ĞŸĞµÑ€ĞµÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ° | âŒ ĞĞµÑ‚ |

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:** Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ `sent` ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½ (2026-02-03). ĞŸÑ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑÑ€Ğ°Ğ·Ñƒ `pending`.

---

## 3. Issues & Risks

### 3.1 ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

#### ~~ISSUE-001: ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Auto Backfill Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°~~ âœ… Ğ Ğ•Ğ¨Ğ•ĞĞ

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… **Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ’ĞĞĞ (2026-02-08)**

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Auto Backfill Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸:

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-----------|------|----------|
| SQL Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ | `supabase/migrations/20260208_001_complaint_backfill_system.sql` | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ |
| TypeScript Ñ‚Ğ¸Ğ¿Ñ‹ | `src/types/backfill.ts` | BackfillJob, DailyLimit Ğ¸ Ğ´Ñ€. |
| DB Helpers | `src/db/backfill-helpers.ts` | CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ |
| Worker Service | `src/services/backfill-worker.ts` | ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ |
| CRON Job | `src/lib/cron-jobs.ts` | Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ |
| API Endpoint | `src/app/api/admin/backfill/route.ts` | ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ |
| Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ | `products/[productId]/status/route.ts`, `bulk-actions/route.ts` | ĞŸÑ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° |

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:**
1. ĞŸÑ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (work_status â†’ 'active') ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ backfill job
2. Worker ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
3. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ batch'Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾ 100 Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ¼ 2000/Ğ´ĞµĞ½ÑŒ Ğ½Ğ° Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½
4. ĞŸÑ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° job ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑÑ Ğ½Ğ° Ğ¿Ğ°ÑƒĞ·Ñƒ Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ
5. Worker Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ paused jobs Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ğ´Ğ½Ñ

**Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· production (Ğ´Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸):**

| ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ | Backlog (Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ±ĞµĞ· Ğ¶Ğ°Ğ»Ğ¾Ğ±) |
|---------|----------------------------|
| ĞĞĞ "Ğ¢Ğ°Ğ¹Ğ´Ğ¸-Ğ¦ĞµĞ½Ñ‚Ñ€" | 28,726 |
| AElectronic | 6,837 |
| ĞĞĞ "Ğ ÑƒĞ±Ğ¸Ğ½" | 1,072 |
| ĞœĞ°ĞºĞ¨ÑƒĞ· ĞĞĞ | 1,048 |
| Duo Belan | 942 |
| Ğ˜ĞŸ ĞÑ€Ñ‚ÑÑˆĞ¸Ğ½Ğ° | 799 |
| Ğ˜ĞŸ ĞœĞ¾Ñ‡Ğ°Ğ»Ğ¾Ğ²Ğ° Ğ. Ğ. | 624 |
| Ğ˜ĞŸ Ğ§ĞµĞºĞ°Ğ½Ğ¾Ğ² Ğ”. Ğ®. | 615 |
| Ğ˜ĞŸ Ğ¡Ñ‚Ñ€Ğ°Ñ… Ğ . Ğ˜. | 614 |
| Ğ˜ĞŸ ĞœĞ°Ñ‚Ğ²ĞµĞµĞ²Ğ° | 399 |
| **Ğ˜Ğ¢ĞĞ“Ğ** | **44,536** |

**Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ñ Auto Backfill:**
- Ğ¡ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ¼ 2000/Ğ´ĞµĞ½ÑŒ: **~22 Ğ´Ğ½Ñ** Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ backlog

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ~~ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ~~ âœ… Ğ Ğ•Ğ¨Ğ•ĞĞ

---

#### ~~ISSUE-002: Legacy Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ >1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²~~ Ğ—ĞĞšĞ Ğ«Ğ¢Ğ

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ SQL-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° (2026-02-08):**

```
âœ… ĞĞ•Ğ¢ Ğ–ĞĞ›ĞĞ‘ ĞŸĞ Ğ•Ğ’Ğ«Ğ¨ĞĞ®Ğ©Ğ˜Ğ¥ 1000 Ğ¡Ğ˜ĞœĞ’ĞĞ›ĞĞ’!
   Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾.
```

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|----------|
| Ğ’ÑĞµĞ³Ğ¾ Ğ¶Ğ°Ğ»Ğ¾Ğ± Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ | 58,550 |
| Ğ’ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ñ… Ğ½Ğ¾Ñ€Ğ¼Ñ‹ (â‰¤800) | 56,328 |
| ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ soft limit (800-1000) | 2,222 |
| **ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ hard limit (>1000)** | **0 (0.00%)** |
| ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ° | 999 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² |
| Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ´Ğ»Ğ¸Ğ½Ğ° | 671 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ» |

**Ğ’Ñ‹Ğ²Ğ¾Ğ´:** ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ¾Ñ‡ĞºĞ°Ñ… Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾.

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ~~Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™~~ Ğ—ĞĞšĞ Ğ«Ğ¢Ğ

---

### 3.2 ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ°

#### ISSUE-003: ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ batch size Ğ² CRON

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
CRON Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 50 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²/Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½/Ñ‡Ğ°Ñ.

**Ğ Ğ°ÑÑ‡Ñ‘Ñ‚:**
- 1000 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ² backlog â†’ 20 Ñ‡Ğ°ÑĞ¾Ğ² Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ
- 5000 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² â†’ 100 Ñ‡Ğ°ÑĞ¾Ğ² (4+ Ğ´Ğ½Ñ)

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ 200-500 Ñ rate limiting.

---

#### ISSUE-004: ĞĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¾Ğ² Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ñ…

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
Ğ’ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ… ĞºĞ¾Ğ´Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñ‹ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¾Ğ²:

| ĞœĞµÑÑ‚Ğ¾ | Ğ”Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ |
|-------|----------|
| `shouldGenerateComplaint()` | 1-4 |
| `findEligibleReviewsForComplaints()` | 1-3 |
| `canUseTemplate()` | 1-3 |
| Reviews Page default filter | 1-3 |

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ. Ğ£Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ñ‚ÑŒ: Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ»Ğ¸ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ½Ğ° 4â˜…?

---

## 4. Proposed Improvements

### 4.1 Auto Backfill Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AUTO BACKFILL SYSTEM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  TRIGGER: Product activated (is_active: false â†’ true)               â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. CREATE BACKFILL JOB                                      â”‚    â”‚
â”‚  â”‚     INSERT INTO complaint_backfill_jobs (                    â”‚    â”‚
â”‚  â”‚       product_id, store_id, status, created_at,             â”‚    â”‚
â”‚  â”‚       total_reviews, processed, remaining                    â”‚    â”‚
â”‚  â”‚     )                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  2. BACKFILL WORKER (CRON or Queue)                         â”‚    â”‚
â”‚  â”‚     â€¢ Schedule: every 15 minutes                            â”‚    â”‚
â”‚  â”‚     â€¢ Pick jobs with status = 'pending' or 'in_progress'    â”‚    â”‚
â”‚  â”‚     â€¢ Process up to DAILY_LIMIT / 24 = ~83/hour             â”‚    â”‚
â”‚  â”‚     â€¢ Track progress                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3. DAILY LIMIT TRACKING                                    â”‚    â”‚
â”‚  â”‚     â€¢ Max 2000 complaints/day per store                     â”‚    â”‚
â”‚  â”‚     â€¢ Reset at midnight (MSK)                               â”‚    â”‚
â”‚  â”‚     â€¢ Store counter in Redis or DB                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4. PROGRESS TRACKING                                       â”‚    â”‚
â”‚  â”‚     â€¢ UI: ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°                    â”‚    â”‚
â”‚  â”‚     â€¢ API: GET /api/products/{id}/backfill-status           â”‚    â”‚
â”‚  â”‚     â€¢ Metrics: processed, remaining, eta                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Database Schema Extension

```sql
-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ backfill jobs
CREATE TABLE complaint_backfill_jobs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  product_id TEXT NOT NULL REFERENCES products(id),
  store_id TEXT NOT NULL REFERENCES stores(id),

  -- Job status
  status TEXT NOT NULL DEFAULT 'pending', -- pending, in_progress, completed, paused
  priority INTEGER DEFAULT 0, -- higher = more urgent

  -- Progress tracking
  total_reviews INTEGER NOT NULL DEFAULT 0,
  processed INTEGER NOT NULL DEFAULT 0,
  failed INTEGER NOT NULL DEFAULT 0,
  remaining INTEGER GENERATED ALWAYS AS (total_reviews - processed) STORED,

  -- Timing
  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  last_processed_at TIMESTAMPTZ,

  -- Daily limit tracking
  daily_generated INTEGER NOT NULL DEFAULT 0,
  daily_limit_date DATE,

  -- Error handling
  last_error TEXT,
  retry_count INTEGER DEFAULT 0,

  UNIQUE(product_id) -- Only one active job per product
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_backfill_status ON complaint_backfill_jobs(status);
CREATE INDEX idx_backfill_store ON complaint_backfill_jobs(store_id);
CREATE INDEX idx_backfill_priority ON complaint_backfill_jobs(priority DESC, created_at ASC);

-- Daily limits table
CREATE TABLE complaint_daily_limits (
  store_id TEXT NOT NULL REFERENCES stores(id),
  date DATE NOT NULL,
  generated INTEGER NOT NULL DEFAULT 0,
  limit_value INTEGER NOT NULL DEFAULT 2000,
  PRIMARY KEY (store_id, date)
);
```

### 4.3 Backfill Worker Algorithm

```typescript
// ĞŸÑĞµĞ²Ğ´Ğ¾ĞºĞ¾Ğ´ Ğ´Ğ»Ñ backfill worker
async function processBackfillJobs() {
  // 1. Get pending jobs ordered by priority
  const jobs = await db.query(`
    SELECT * FROM complaint_backfill_jobs
    WHERE status IN ('pending', 'in_progress')
    ORDER BY priority DESC, created_at ASC
    LIMIT 10
  `);

  for (const job of jobs) {
    // 2. Check daily limit
    const dailyCount = await getDailyGeneratedCount(job.store_id);
    const remainingToday = DAILY_LIMIT - dailyCount;

    if (remainingToday <= 0) {
      // Skip until tomorrow
      await markJobPaused(job.id, 'daily_limit_reached');
      continue;
    }

    // 3. Get batch of reviews to process
    const batchSize = Math.min(remainingToday, MAX_BATCH_SIZE);
    const reviews = await getEligibleReviewsForProduct(
      job.product_id,
      batchSize,
      job.processed // offset
    );

    if (reviews.length === 0) {
      await markJobCompleted(job.id);
      continue;
    }

    // 4. Generate complaints
    const result = await generateComplaintsBatch(job.store_id, reviews.map(r => r.id));

    // 5. Update progress
    await updateJobProgress(job.id, {
      processed: job.processed + reviews.length,
      failed: job.failed + result.failed,
      daily_generated: job.daily_generated + result.generated,
    });

    // 6. Update daily limit
    await incrementDailyLimit(job.store_id, result.generated);
  }
}
```

---

## 5. SQL Queries for Analysis

### 5.1 Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹ > 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

```sql
-- Ğ’ÑĞµ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ñ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ > 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
SELECT
  id,
  review_id,
  store_id,
  LENGTH(complaint_text) as text_length,
  status,
  generated_at,
  created_at
FROM review_complaints
WHERE LENGTH(complaint_text) > 1000
ORDER BY text_length DESC;
```

### 5.2 ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°Ğ¼

```sql
-- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ oversized Ğ¶Ğ°Ğ»Ğ¾Ğ± Ğ¿Ğ¾ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°Ğ¼
SELECT
  rc.store_id,
  s.name as store_name,
  COUNT(*) as oversized_count,
  AVG(LENGTH(rc.complaint_text)) as avg_length,
  MAX(LENGTH(rc.complaint_text)) as max_length
FROM review_complaints rc
JOIN stores s ON rc.store_id = s.id
WHERE LENGTH(rc.complaint_text) > 1000
GROUP BY rc.store_id, s.name
ORDER BY oversized_count DESC;
```

### 5.3 ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼

```sql
-- Oversized Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼ (Ğ´Ğ»Ñ Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ¸Ñ legacy)
SELECT
  DATE(generated_at) as generation_date,
  COUNT(*) as oversized_count,
  COUNT(*) FILTER (WHERE status = 'draft') as draft_count,
  COUNT(*) FILTER (WHERE status != 'draft') as sent_count
FROM review_complaints
WHERE LENGTH(complaint_text) > 1000
GROUP BY DATE(generated_at)
ORDER BY generation_date DESC;
```

### 5.4 ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

```sql
-- ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ oversized Ğ¾Ñ‚ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°
SELECT
  COUNT(*) as total_complaints,
  COUNT(*) FILTER (WHERE LENGTH(complaint_text) > 1000) as oversized_count,
  ROUND(
    100.0 * COUNT(*) FILTER (WHERE LENGTH(complaint_text) > 1000) / COUNT(*),
    2
  ) as oversized_percent,
  COUNT(*) FILTER (WHERE LENGTH(complaint_text) > 800) as soft_limit_exceeded
FROM review_complaints;
```

### 5.5 Backlog Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

```sql
-- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ±ĞµĞ· Ğ¶Ğ°Ğ»Ğ¾Ğ± (backlog)
SELECT
  r.store_id,
  s.name as store_name,
  COUNT(*) as backlog_count
FROM reviews r
JOIN stores s ON r.store_id = s.id
WHERE r.rating IN (1, 2, 3)
  AND r.date >= '2023-10-01'
  AND r.is_product_active = TRUE
  AND s.status = 'active'
  AND NOT EXISTS (
    SELECT 1 FROM review_complaints c WHERE c.review_id = r.id
  )
  AND (r.complaint_status IS NULL OR r.complaint_status = 'not_sent')
GROUP BY r.store_id, s.name
ORDER BY backlog_count DESC;
```

---

## 5.6 Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ SQL-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° (2026-02-08)

Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚: `npx tsx scripts/analyze-oversized-complaints.ts`

### Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹ > 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

```
âœ… ĞĞ•Ğ¢ Ğ–ĞĞ›ĞĞ‘ ĞŸĞ Ğ•Ğ’Ğ«Ğ¨ĞĞ®Ğ©Ğ˜Ğ¥ 1000 Ğ¡Ğ˜ĞœĞ’ĞĞ›ĞĞ’!
   Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾.

ğŸ“ˆ Ğ’ÑĞµĞ³Ğ¾ Ğ¶Ğ°Ğ»Ğ¾Ğ± Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ: 58,550
   âœ… Ğ’ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ñ… Ğ½Ğ¾Ñ€Ğ¼Ñ‹ (â‰¤800): 56,328 (96.2%)
   âš ï¸  Soft limit (800-1000): 2,222 (3.8%)
   âŒ Hard limit (>1000): 0 (0.00%)

ğŸ“ ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ°: 999 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
ğŸ“ Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ´Ğ»Ğ¸Ğ½Ğ°: 671 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»
```

### Backlog Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ±ĞµĞ· Ğ¶Ğ°Ğ»Ğ¾Ğ±

```
ğŸ“Š Ğ’ÑĞµĞ³Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² Ğ±ĞµĞ· Ğ¶Ğ°Ğ»Ğ¾Ğ±: 44,536

Ğ¢Ğ¾Ğ¿-10 Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ¾Ğ²:
1. ĞĞĞ "Ğ¢Ğ°Ğ¹Ğ´Ğ¸-Ğ¦ĞµĞ½Ñ‚Ñ€"     28,726
2. AElectronic            6,837
3. ĞĞĞ "Ğ ÑƒĞ±Ğ¸Ğ½"            1,072
4. ĞœĞ°ĞºĞ¨ÑƒĞ· ĞĞĞ             1,048
5. Duo Belan                942
6. Ğ˜ĞŸ ĞÑ€Ñ‚ÑÑˆĞ¸Ğ½Ğ°              799
7. Ğ˜ĞŸ ĞœĞ¾Ñ‡Ğ°Ğ»Ğ¾Ğ²Ğ° Ğ. Ğ.        624
8. Ğ˜ĞŸ Ğ§ĞµĞºĞ°Ğ½Ğ¾Ğ² Ğ”. Ğ®.         615
9. Ğ˜ĞŸ Ğ¡Ñ‚Ñ€Ğ°Ñ… Ğ . Ğ˜.           614
10. Ğ˜ĞŸ ĞœĞ°Ñ‚Ğ²ĞµĞµĞ²Ğ°              399
```

### Ğ’Ñ‹Ğ²Ğ¾Ğ´Ñ‹

1. **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²** Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ¾Ñ‡ĞºĞ°Ñ…
2. **Backlog 44,536 Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²** Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Auto Backfill
3. **Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ CRON** Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ backlog Ğ·Ğ° ~37 Ğ´Ğ½ĞµĞ¹
4. **Ğ¡ Auto Backfill** (2000/Ğ´ĞµĞ½ÑŒ) â€” Ğ·Ğ° ~22 Ğ´Ğ½Ñ

---

## 6. Backlog

### MVP (Phase 1) â€” âœ… Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Effort | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-----------|--------|--------|
| MVP-001 | SQL-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¶Ğ°Ğ»Ğ¾Ğ± >1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² (read-only) | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ | S | âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ (0 Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼) |
| MVP-002 | ~~Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ/Ñ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ oversized Ğ¶Ğ°Ğ»Ğ¾Ğ±~~ | ~~ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾~~ | ~~M~~ | âœ… ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ |
| MVP-003 | Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ CRON batch size Ğ´Ğ¾ 200 | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ | S | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |
| MVP-004 | Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¸ (1-3 vs 1-4) | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ | S | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |

### Phase 2 â€” âœ… Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ (2026-02-08)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Effort | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-----------|--------|--------|
| P2-001 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ complaint_backfill_jobs | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ | M | âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ |
| P2-002 | Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ backfill worker | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ | L | âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ |
| P2-003 | API Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° backfill | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ | M | âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ |
| P2-004 | Daily limit tracking | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ | M | âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ |

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:**
- `supabase/migrations/20260208_001_complaint_backfill_system.sql`
- `src/types/backfill.ts`
- `src/db/backfill-helpers.ts`
- `src/services/backfill-worker.ts`
- `src/lib/cron-jobs.ts` (startBackfillWorker)
- `src/app/api/admin/backfill/route.ts`
- `src/app/api/stores/[storeId]/products/[productId]/status/route.ts` (Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€)
- `src/app/api/stores/[storeId]/products/bulk-actions/route.ts` (Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€)

### Phase 3

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Effort | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-----------|--------|--------|
| P3-001 | UI Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ | M | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |
| P3-002 | Email/webhook ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¸ | ĞĞ¸Ğ·ĞºĞ¸Ğ¹ | M | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |
| P3-003 | ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ backfill | ĞĞ¸Ğ·ĞºĞ¸Ğ¹ | L | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |
| P3-004 | Priority queue Ğ´Ğ»Ñ VIP ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² | ĞĞ¸Ğ·ĞºĞ¸Ğ¹ | M | ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ |

---

## 7. Definition of Done Checklist

- [x] ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¶Ğ°Ğ»Ğ¾Ğ±
- [x] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ‚Ğ¾Ñ‡ĞµĞº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- [x] ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹ (1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
- [x] ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ² Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [x] ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° ĞÑ‚Ğ·Ñ‹Ğ²Ñ‹
- [x] SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° >1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² (Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹)
- [x] **SQL-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½** (2026-02-08) â€” 0 Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼
- [x] Ğ¡Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ°Ğ²Ñ‚Ğ¾-Ğ´Ğ¾Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ (Auto Backfill)
- [x] Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ backlog (MVP / Phase 2 / Phase 3)
- [x] ĞĞµÑ‚ Ğ½ĞµĞ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ¾Ğ½

---

## 8. Next Steps

1. ~~**Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ñ‚ÑŒ** ÑÑ‚Ğ¾Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ñ Ğ·Ğ°ĞºĞ°Ğ·Ñ‡Ğ¸ĞºĞ¾Ğ¼~~ âœ… Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾
2. ~~**Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ** SQL-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ² production Ğ‘Ğ”~~ âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ (0 oversized Ğ¶Ğ°Ğ»Ğ¾Ğ±)
3. ~~**ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ** Ğ¿Ğ¾ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ğ°Ğ¼ >1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²~~ âœ… ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ (Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚)
4. ~~**Ğ£Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ** Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ Auto Backfill~~ âœ… Ğ£Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾
5. ~~**Ğ”ĞµĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ** Ğ² ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ñ‹~~ âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾
6. ~~**ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ** Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ~~ âœ… **Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ’ĞĞĞ (2026-02-08)**

### âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸

| # | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|---|--------|--------|
| 1 | Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Auto Backfill | âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ |
| 2 | Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° | âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ |
| 3 | CRON worker ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ | âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ |
| 4 | API Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° | âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ |
| 5 | Daily limit tracking (2000/Ğ´ĞµĞ½ÑŒ) | âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ |

### ĞÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ (Phase 3)

| # | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ |
|---|--------|-----------|
| 1 | UI Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ |
| 2 | Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ CRON batch size 50 â†’ 200 | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ |
| 3 | Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¸ (1-3 vs 1-4) | Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ |

---

## Appendix A: File References

### Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| [auto-complaint-generator.ts](src/services/auto-complaint-generator.ts) | Event-driven Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ |
| [cron-jobs.ts](src/lib/cron-jobs.ts) | CRON fallback + Backfill worker |
| [generate-review-complaint-flow.ts](src/ai/flows/generate-review-complaint-flow.ts) | AI/Template flow |
| [complaint-text-validator.ts](src/ai/utils/complaint-text-validator.ts) | Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² |
| [complaint-templates.ts](src/ai/utils/complaint-templates.ts) | Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¿ÑƒÑÑ‚Ñ‹Ñ… Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ² |
| [optimized-review-complaint-prompt.ts](src/ai/prompts/optimized-review-complaint-prompt.ts) | AI Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ |
| [complaint-helpers.ts](src/db/complaint-helpers.ts) | Database helpers |
| [complaints.ts](src/types/complaints.ts) | TypeScript Ñ‚Ğ¸Ğ¿Ñ‹ |

### ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Auto Backfill (2026-02-08)

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| [20260208_001_complaint_backfill_system.sql](supabase/migrations/20260208_001_complaint_backfill_system.sql) | SQL Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸, view) |
| [backfill.ts](src/types/backfill.ts) | TypeScript Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ backfill |
| [backfill-helpers.ts](src/db/backfill-helpers.ts) | DB helpers Ğ´Ğ»Ñ backfill jobs |
| [backfill-worker.ts](src/services/backfill-worker.ts) | Worker service |
| [backfill/route.ts](src/app/api/admin/backfill/route.ts) | API endpoint Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° |

---

*ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ĞºĞ¾Ğ´Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹ R5 SAAS-PROD.*
*ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 2026-02-08 (Auto Backfill Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½)*
