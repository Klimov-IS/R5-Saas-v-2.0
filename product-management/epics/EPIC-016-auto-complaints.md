# EPIC-016: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∞–ª–æ–± –Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã

**–°—Ç–∞—Ç—É—Å:** üìã Backlog
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)
**RICE Score:** 72
**–ö–≤–∞—Ä—Ç–∞–ª:** Q2 2025 (–ê–ø—Ä–µ–ª—å - –ò—é–Ω—å)
**–û—Ü–µ–Ω–∫–∞:** 2 –Ω–µ–¥–µ–ª–∏ (8 SP)
**–í–ª–∞–¥–µ–ª–µ—Ü:** Product Manager

---

## –ü—Ä–æ–±–ª–µ–º–∞

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤:**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤—Ä—É—á–Ω—É—é —á–∏—Ç–∞–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–∑—ã–≤
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏—á–∏–Ω—É (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª WB –∏–ª–∏ –Ω–µ—Ç)
3. –ü–∏—à–µ—Ç –∂–∞–ª–æ–±—É –≤ Wildberries Support
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É WB
5. **–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏: 600‚ÇΩ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ**

**–ë–æ–ª—å:**
- –¢—Ä–∞—Ç–∏—Ç—Å—è 15-20 –º–∏–Ω—É—Ç –Ω–∞ –∫–∞–∂–¥—É—é –∂–∞–ª–æ–±—É
- –ù—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ WB
- –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä: –∑–∞–±—ã–≤–∞—é—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—ã
- –¢–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è = —Ç–µ—Ä—è—é—Ç—Å—è –¥–µ–Ω—å–≥–∏ (600‚ÇΩ/–∂–∞–ª–æ–±—É)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å:**
- 80% –∂–∞–ª–æ–± –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é AI
- –®–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π (–º–∞—Ç, –æ—Ñ—Ñ-—Ç–æ–ø–∏–∫, —Ä–µ–∫–ª–∞–º–∞)

---

## –†–µ—à–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∞–ª–æ–± —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ (—Ä–µ–π—Ç–∏–Ω–≥ 1-2 –∑–≤–µ–∑–¥—ã).

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
1. –¢—Ä–∏–≥–≥–µ—Ä: –ø–æ—Å–ª–µ `refreshReviews()` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º ‚â§ 2
2. AI –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø—Ä–∏—á–∏–Ω—É –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–¥–æ—Å—Ç–∞–≤–∫–∞, –∫–∞—á–µ—Å—Ç–≤–æ, –º–∞—Ç, –æ—Ñ—Ñ-—Ç–æ–ø–∏–∫)
3. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª WB ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ –∂–∞–ª–æ–±—ã
4. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç –≥–æ—Ç–æ–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ UI
5. –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∂–∞–ª–æ–± (—Å—Ç–∞—Ç—É—Å, –¥–∞—Ç–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å:**
- –¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥: 600‚ÇΩ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ‚Üí –º–æ–∂–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∂–∞–ª–æ–±
- –£–ª—É—á—à–∞–µ—Ç unit economics —Å–µ—Ä–≤–∏—Å–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤

---

## User Stories

### US-031: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –∂–∞–ª–æ–±
**–ö–∞–∫:** –º–µ–Ω–µ–¥–∂–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** —á—Ç–æ–±—ã –∂–∞–ª–æ–±—ã –Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å
**–ß—Ç–æ–±—ã:** –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

**Acceptance Criteria:**
- ‚úÖ –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º ‚â§ 2 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è AI
- ‚úÖ –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ WB ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–Ω–æ–≤–∏–∫ –∂–∞–ª–æ–±—ã
- ‚úÖ –í UI –æ—Ç–∑—ã–≤–∞ –≤–∏–∂—É –±–µ–π–¥–∂ "–ñ–∞–ª–æ–±–∞ –≥–æ—Ç–æ–≤–∞"
- ‚úÖ –ú–æ–≥—É –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
- ‚úÖ –ò–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∂–∞–ª–æ–±—É (–µ—Å–ª–∏ –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω —Å AI)

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

### US-032: –û—Ç–ø—Ä–∞–≤–∫–∞ –∂–∞–ª–æ–± –≤ WB
**–ö–∞–∫:** –º–µ–Ω–µ–¥–∂–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∂–∞–ª–æ–±—ã –≤ Wildberries –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
**–ß—Ç–æ–±—ã:** —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤

**Acceptance Criteria:**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É" –≤ UI –æ—Ç–∑—ã–≤–∞
- ‚úÖ –ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WB API (–∏–ª–∏ form submission)
- ‚úÖ –í–∏–∂—É —Å—Ç–∞—Ç—É—Å –∂–∞–ª–æ–±—ã: "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞", "–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏", "–û–¥–æ–±—Ä–µ–Ω–∞", "–û—Ç–∫–ª–æ–Ω–µ–Ω–∞"
- ‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

**Story Points:** 3 SP (2-3 –¥–Ω—è)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### AI Prompt –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

```typescript
const COMPLAINT_CLASSIFICATION_PROMPT = `
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Wildberries. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–∑—ã–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞—Ä—É—à–∞–µ—Ç –ª–∏ –æ–Ω –ø—Ä–∞–≤–∏–ª–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

–ü—Ä–∞–≤–∏–ª–∞ WB (–∑–∞–ø—Ä–µ—â–µ–Ω–æ):
1. –ù–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
2. Off-topic (–æ—Ç–∑—ã–≤ –Ω–µ –æ —Ç–æ–≤–∞—Ä–µ, –∞ –æ –¥–æ—Å—Ç–∞–≤–∫–µ/WB)
3. –†–µ–∫–ª–∞–º–∞ –¥—Ä—É–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤/–º–∞–≥–∞–∑–∏–Ω–æ–≤
4. Spam, –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
5. –£–≥—Ä–æ–∑—ã, –≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ

–û—Ç–∑—ã–≤:
"${reviewText}"

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "violates_rules": true/false,
  "violation_type": "profanity" | "off_topic" | "advertising" | "spam" | "threats" | "none",
  "complaint_text": "–¢–µ–∫—Å—Ç –∂–∞–ª–æ–±—ã –¥–ª—è WB Support (–µ—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)",
  "confidence": 0.0-1.0
}
`;
```

### Firestore Schema

```typescript
// stores/{storeId}/products/{productId}/reviews/{reviewId}
interface Review {
  // ... existing fields

  // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –∂–∞–ª–æ–±
  complaintDraft?: {
    generated: boolean; // –°–æ–∑–¥–∞–Ω–∞ AI?
    violationType: 'profanity' | 'off_topic' | 'advertising' | 'spam' | 'threats';
    complaintText: string; // –¢–µ–∫—Å—Ç –∂–∞–ª–æ–±—ã
    confidence: number; // 0.0-1.0
    generatedAt: Timestamp;
  };

  complaintStatus?: 'draft' | 'sent' | 'under_review' | 'approved' | 'rejected';
  complaintSentAt?: Timestamp;
  complaintResult?: string; // –û—Ç–≤–µ—Ç –æ—Ç WB
}

// stores/{storeId}/complaints/{complaintId}
interface Complaint {
  storeId: string;
  reviewId: string;
  productId: string;

  // –î–µ—Ç–∞–ª–∏ –æ—Ç–∑—ã–≤–∞
  reviewRating: number;
  reviewText: string;
  reviewAuthor: string;
  reviewDate: Timestamp;

  // –ñ–∞–ª–æ–±–∞
  violationType: string;
  complaintText: string;
  status: 'draft' | 'sent' | 'under_review' | 'approved' | 'rejected';

  // Metadata
  generatedByAI: boolean;
  editedByUser: boolean;
  sentAt?: Timestamp;
  resolvedAt?: Timestamp;
  wbResponse?: string;

  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### Cloud Function Implementation

```typescript
// functions/src/triggers/on-review-created.ts

import * as functions from 'firebase-functions';
import { firestore } from '../firebase-admin';
import { generateComplaint } from '../ai/generate-complaint';

export const onReviewCreated = functions.firestore
  .document('stores/{storeId}/products/{productId}/reviews/{reviewId}')
  .onCreate(async (snap, context) => {
    const review = snap.data();
    const { storeId, productId, reviewId } = context.params;

    // –¢–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ (‚â§ 2 –∑–≤–µ–∑–¥—ã)
    if (review.rating > 2) {
      return null;
    }

    try {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∂–∞–ª–æ–±—É —á–µ—Ä–µ–∑ AI
      const result = await generateComplaint(review.text);

      if (result.violates_rules && result.confidence > 0.7) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–∑—ã–≤
        await snap.ref.update({
          complaintDraft: {
            generated: true,
            violationType: result.violation_type,
            complaintText: result.complaint_text,
            confidence: result.confidence,
            generatedAt: new Date(),
          },
          complaintStatus: 'draft',
        });

        // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ complaints
        await firestore
          .collection('stores').doc(storeId)
          .collection('complaints').add({
            storeId,
            reviewId,
            productId,
            reviewRating: review.rating,
            reviewText: review.text,
            reviewAuthor: review.author,
            reviewDate: review.date,
            violationType: result.violation_type,
            complaintText: result.complaint_text,
            status: 'draft',
            generatedByAI: true,
            editedByUser: false,
            createdAt: new Date(),
            updatedAt: new Date(),
          });

        console.log(`Complaint generated for review ${reviewId}`);
      } else {
        console.log(`No violation detected for review ${reviewId}`);
      }

    } catch (error) {
      console.error(`Failed to generate complaint for review ${reviewId}:`, error);
    }

    return null;
  });
```

### AI Generation Logic

```typescript
// src/ai/generate-complaint.ts

import { deepseek } from '@/lib/deepseek-client';

interface ComplaintResult {
  violates_rules: boolean;
  violation_type: string;
  complaint_text: string;
  confidence: number;
}

export async function generateComplaint(reviewText: string): Promise<ComplaintResult> {
  const prompt = `
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Wildberries. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–∑—ã–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ.

–ü—Ä–∞–≤–∏–ª–∞ WB (–∑–∞–ø—Ä–µ—â–µ–Ω–æ):
1. –ù–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
2. Off-topic (–æ—Ç–∑—ã–≤ –Ω–µ –æ —Ç–æ–≤–∞—Ä–µ, –∞ –æ –¥–æ—Å—Ç–∞–≤–∫–µ/WB)
3. –†–µ–∫–ª–∞–º–∞ –¥—Ä—É–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤/–º–∞–≥–∞–∑–∏–Ω–æ–≤
4. Spam, –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
5. –£–≥—Ä–æ–∑—ã, –≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ

–û—Ç–∑—ã–≤: "${reviewText}"

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "violates_rules": true/false,
  "violation_type": "profanity" | "off_topic" | "advertising" | "spam" | "threats" | "none",
  "complaint_text": "–¢–µ–∫—Å—Ç –∂–∞–ª–æ–±—ã –¥–ª—è WB Support",
  "confidence": 0.0-1.0
}
`;

  const response = await deepseek.chat.completions.create({
    model: 'deepseek-chat',
    messages: [{ role: 'user', content: prompt }],
    response_format: { type: 'json_object' },
    temperature: 0.3,
  });

  const result = JSON.parse(response.choices[0].message.content);

  // Fallback –µ—Å–ª–∏ AI –Ω–µ –≤–µ—Ä–Ω—É–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  if (!result.violation_type) {
    return {
      violates_rules: false,
      violation_type: 'none',
      complaint_text: '',
      confidence: 0,
    };
  }

  // –î–æ–±–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω –∂–∞–ª–æ–±—ã
  if (result.violates_rules) {
    result.complaint_text = formatComplaintText(
      result.violation_type,
      reviewText
    );
  }

  return result;
}

function formatComplaintText(violationType: string, reviewText: string): string {
  const templates = {
    profanity: `
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ—à—É —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—É—é –ª–µ–∫—Å–∏–∫—É –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Wildberries.

–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞: "${reviewText}"

–î–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –æ—Ç–∑—ã–≤–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—É—é –ª–µ–∫—Å–∏–∫—É.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º.
    `,
    off_topic: `
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ—à—É —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤, –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ —Ç–æ–≤–∞—Ä—É.

–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞: "${reviewText}"

–û—Ç–∑—ã–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ –∫ —Ä–∞–±–æ—Ç–µ —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏/Wildberries, –∞ –Ω–µ –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞. –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç–∑—ã–≤–æ–≤.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º.
    `,
    advertising: `
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ—à—É —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ä–µ–∫–ª–∞–º—É —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞: "${reviewText}"

–û—Ç–∑—ã–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–ª–∞–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —á—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º–∏ Wildberries.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º.
    `,
    spam: `
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ—à—É —É–¥–∞–ª–∏—Ç—å —Å–ø–∞–º-–æ—Ç–∑—ã–≤.

–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞: "${reviewText}"

–û—Ç–∑—ã–≤ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ –∏ —è–≤–ª—è–µ—Ç—Å—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–∏–º–≤–æ–ª–æ–≤/—Ç–µ–∫—Å—Ç–∞.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º.
    `,
    threats: `
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ—à—É —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —É–≥—Ä–æ–∑—ã.

–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞: "${reviewText}"

–û—Ç–∑—ã–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–≥—Ä–æ–∑—ã –∏ –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–∞, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä—å–µ–∑–Ω—ã–º –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º.
    `,
  };

  return templates[violationType] || '';
}
```

### UI Component

```tsx
// src/components/ComplaintBadge.tsx

'use client';

import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Textarea } from '@/components/ui/textarea';
import { useState } from 'react';

export function ComplaintBadge({ review }: { review: Review }) {
  const [isOpen, setIsOpen] = useState(false);
  const [complaintText, setComplaintText] = useState(review.complaintDraft?.complaintText || '');
  const [isSending, setIsSending] = useState(false);

  if (!review.complaintDraft) {
    return null;
  }

  const handleSendComplaint = async () => {
    setIsSending(true);
    try {
      await fetch('/api/complaints/send', {
        method: 'POST',
        body: JSON.stringify({
          reviewId: review.id,
          complaintText,
        }),
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
      alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
      setIsOpen(false);
    } finally {
      setIsSending(false);
    }
  };

  return (
    <>
      <Badge
        variant={review.complaintStatus === 'draft' ? 'secondary' : 'default'}
        className="cursor-pointer"
        onClick={() => setIsOpen(true)}
      >
        {review.complaintStatus === 'draft' && 'üìù –ñ–∞–ª–æ–±–∞ –≥–æ—Ç–æ–≤–∞'}
        {review.complaintStatus === 'sent' && 'üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'}
        {review.complaintStatus === 'approved' && '‚úÖ –û–¥–æ–±—Ä–µ–Ω–∞'}
        {review.complaintStatus === 'rejected' && '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞'}
      </Badge>

      <Dialog open={isOpen} onOpenChange={setIsOpen}>
        <DialogContent className="max-w-2xl">
          <DialogHeader>
            <DialogTitle>–ñ–∞–ª–æ–±–∞ –Ω–∞ –æ—Ç–∑—ã–≤</DialogTitle>
          </DialogHeader>

          <div className="space-y-4">
            <div>
              <label className="font-medium">–û—Ç–∑—ã–≤ ({review.rating}‚òÖ)</label>
              <p className="text-sm text-muted-foreground">{review.text}</p>
            </div>

            <div>
              <label className="font-medium">–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è</label>
              <Badge>{review.complaintDraft.violationType}</Badge>
              <span className="text-sm text-muted-foreground ml-2">
                (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {(review.complaintDraft.confidence * 100).toFixed(0)}%)
              </span>
            </div>

            <div>
              <label className="font-medium">–¢–µ–∫—Å—Ç –∂–∞–ª–æ–±—ã</label>
              <Textarea
                value={complaintText}
                onChange={(e) => setComplaintText(e.target.value)}
                rows={8}
              />
              <p className="text-xs text-muted-foreground mt-1">
                –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
              </p>
            </div>

            <div className="flex gap-2">
              <Button
                onClick={handleSendComplaint}
                disabled={isSending || !complaintText.trim()}
              >
                {isSending ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É'}
              </Button>
              <Button variant="outline" onClick={() => setIsOpen(false)}>
                –û—Ç–º–µ–Ω–∞
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </>
  );
}
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**KPIs:**
- ‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: 15 –º–∏–Ω ‚Üí 2 –º–∏–Ω (–Ω–∞ –∂–∞–ª–æ–±—É)
- üéØ –¢–æ—á–Ω–æ—Å—Ç—å AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: > 80%
- üìà –ö–æ–ª-–≤–æ –∂–∞–ª–æ–±/–º–µ—Å—è—Ü: +200% (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- üí∞ –î–æ—Ö–æ–¥ –æ—Ç —É–¥–∞–ª–µ–Ω–∏–π: +200% (600‚ÇΩ √ó –±–æ–ª—å—à–µ –∂–∞–ª–æ–±)

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ö–æ–ª-–≤–æ –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∂–∞–ª–æ–±
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö WB –∂–∞–ª–æ–±
- –í—Ä–µ–º—è –æ—Ç –æ—Ç–∑—ã–≤–∞ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±—ã

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–í–Ω–µ—à–Ω–∏–µ:**
- Deepseek API –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞
- Wildberries API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–± (–∏–ª–∏ form submission)

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:**
- Firestore triggers (onCreate –¥–ª—è reviews)
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤

---

## Risks & Mitigation

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| AI –æ—à–∏–±–∞–µ—Ç—Å—è (false positive) | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Confidence threshold 0.7, —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π |
| WB –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞ —Å–ø–∞–º –∂–∞–ª–æ–± | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Rate limiting, —Ç–æ–ª—å–∫–æ –∂–∞–ª–æ–±—ã —Å confidence > 0.8 |
| –ù–µ—Ç API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–± | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç + —Å—Å—ã–ª–∫—É –Ω–∞ WB Support —Ñ–æ—Ä–º—É |

---

## Timeline

**Week 1:**
- Day 1-2: AI prompt + generation logic
- Day 3-4: Firestore trigger + schema
- Day 5: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∂–∞–ª–æ–±

**Week 2:**
- Day 1-2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WB API (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∂–∞–ª–æ–±)
- Day 3-4: –°—Ç–∞—Ç—É—Å—ã –∂–∞–ª–æ–± + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Day 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + rollout

---

## –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**–ü—Ä—è–º–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –¥–æ—Ö–æ–¥:**
- –¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥: **600‚ÇΩ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞**
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ 7x —Ä–∞–∑ –±–æ–ª—å—à–µ –∂–∞–ª–æ–±
- **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: 50+ —É–¥–∞–ª–µ–Ω–∏–π/–º–µ—Å—è—Ü = 30,000‚ÇΩ/–º–µ—Å—è—Ü –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞**

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ $100 –ø–æ–¥–ø–∏—Å–∫—É:**
- –ê–≤—Ç–æ–∂–∞–ª–æ–±—ã = **Premium feature** (—Ç–æ–ª—å–∫–æ –≤ Full –≤–µ—Ä—Å–∏–∏)
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —Ç–∞–∫—É—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é

**Value Proposition:**
- "AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∂–∞–ª–æ–±—ã –Ω–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª WB"
- "–£–¥–∞–ª—è–π—Ç–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –≤ 7x —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ"

---

## Definition of Done

- ‚úÖ AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –æ—Ç–∑—ã–≤ ‚â§ 2‚òÖ –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –∂–∞–ª–æ–± (confidence > 0.7)
- ‚úÖ UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WB API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∂–∞–ª–æ–±: draft ‚Üí sent ‚Üí under_review ‚Üí approved/rejected
- ‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∂–∞–ª–æ–± –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 50+ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–∞—Ö
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å AI > 80% (manual review)

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–≤—å—é:** Sprint Planning Q2 2025
