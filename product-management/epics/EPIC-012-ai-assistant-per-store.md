# EPIC-012: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞

**–°—Ç–∞—Ç—É—Å:** üìã Backlog
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2 (–°—Ä–µ–¥–Ω–∏–π)
**RICE Score:** 40
**–ö–≤–∞—Ä—Ç–∞–ª:** Q3 2025 (–ò—é–ª—å - –°–µ–Ω—Ç—è–±—Ä—å)
**–û—Ü–µ–Ω–∫–∞:** 6 –Ω–µ–¥–µ–ª—å (28 SP)
**–í–ª–∞–¥–µ–ª–µ—Ü:** Product Manager

---

## –ü—Ä–æ–±–ª–µ–º–∞

–°–µ–π—á–∞—Å AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ **–æ–±—â–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤** –±–µ–∑ —É—á–µ—Ç–∞:
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
- –¢–æ–Ω–∞ –∏ —Å—Ç–∏–ª—è –±—Ä–µ–Ω–¥–∞
- FAQ –∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
- –ò—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Ç–≤–µ—Ç—ã –∑–≤—É—á–∞—Ç —à–∞–±–ª–æ–Ω–Ω–æ
- AI –Ω–µ –∑–Ω–∞–µ—Ç –¥–µ—Ç–∞–ª–µ–π (—Ä–∞–∑–º–µ—Ä–Ω–∞—è —Å–µ—Ç–∫–∞, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –¥–æ—Å—Ç–∞–≤–∫–∞)
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã —Ç—Ä–∞—Ç—è—Ç –≤—Ä–µ–º—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É AI-–æ—Ç–≤–µ—Ç–æ–≤

**–í–∏–¥–µ–Ω–∏–µ:**
–ö–∞–∂–¥—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–π:
- –ó–Ω–∞–µ—Ç –≤—Å–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, FAQ)
- –û—Ç–≤–µ—á–∞–µ—Ç –≤ —Å—Ç–∏–ª–µ –±—Ä–µ–Ω–¥–∞
- –û–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- –£–ª—É—á—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

---

## –†–µ—à–µ–Ω–∏–µ

**AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ = AI –º–æ–¥–µ–ª—å + –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π + –ù–∞—Å—Ç—Ä–æ–π–∫–∏**

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (Knowledge Base)**
   - FAQ –ø–æ —Ç–æ–≤–∞—Ä–∞–º (–∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Google Sheets)
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ WB API
   - –ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (–¥–ª—è –æ–±—É—á–µ–Ω–∏—è)
   - –ü–æ–ª–∏—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞, –≤–æ–∑–≤—Ä–∞—Ç, –≥–∞—Ä–∞–Ω—Ç–∏—è)

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI**
   - –¢–æ–Ω: —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π / –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π / –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π
   - –Ø–∑—ã–∫: —Ä—É—Å—Å–∫–∏–π / –∞–Ω–≥–ª–∏–π—Å–∫–∏–π / –¥–≤—É—è–∑—ã—á–Ω—ã–π
   - –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–º—ã (–Ω–µ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞—Ö)
   - –®–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

3. **RAG (Retrieval-Augmented Generation)**
   - AI —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
   - –ó–∞—Ç–µ–º –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ—á–Ω—ã–µ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

4. **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è: Pay-per-token**
   - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ AI = —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç –∑–∞ —Ç–æ–∫–µ–Ω—ã —Ä—É–±–ª—è–º–∏
   - **–ú–æ–¥–µ–ª—å: 1000 —Ç–æ–∫–µ–Ω–æ–≤ = 50‚ÇΩ**
   - Target LTV: 5,000‚ÇΩ/–º–∞–≥–∞–∑–∏–Ω –≤ –º–µ—Å—è—Ü

---

## User Stories

### US-036: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω–∞
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –∑–∞–≥—Ä—É–∑–∏—Ç—å FAQ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–∞—Ö –≤ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
**–ß—Ç–æ–±—ã:** AI –æ—Ç–≤–µ—á–∞–ª —Ç–æ—á–Ω–æ –∏ —Å —É—á–µ—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –º–æ–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

**Acceptance Criteria:**
- ‚úÖ –ú–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å FAQ –≤—Ä—É—á–Ω—É—é (–≤–æ–ø—Ä–æ—Å + –æ—Ç–≤–µ—Ç)
- ‚úÖ –ú–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å FAQ –∏–∑ Google Sheets
- ‚úÖ AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ WB API
- ‚úÖ –ú–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –º–∞–≥–∞–∑–∏–Ω–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞, –≤–æ–∑–≤—Ä–∞—Ç)
- ‚úÖ –í–∏–∂—É —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–Ω–∞–Ω–∏–π –≤ –±–∞–∑–µ (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**Story Points:** 8 SP (1 –Ω–µ–¥–µ–ª—è)

---

### US-037: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è –∏ —Ç–æ–Ω–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ AI –±—É–¥–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏
**–ß—Ç–æ–±—ã:** –æ—Ç–≤–µ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∏–º–∏–¥–∂—É –º–æ–µ–≥–æ –±—Ä–µ–Ω–¥–∞

**Acceptance Criteria:**
- ‚úÖ –í—ã–±–∏—Ä–∞—é —Ç–æ–Ω: —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π / –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π / –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π
- ‚úÖ –î–æ–±–∞–≤–ª—è—é —Ñ–∏—Ä–º–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!")
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–º—ã (–æ —á–µ–º –Ω–µ –æ—Ç–≤–µ—á–∞–µ–º)
- ‚úÖ –í–∏–∂—É preview –æ—Ç–≤–µ—Ç–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ
- ‚úÖ –ú–æ–≥—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

### US-038: RAG (–ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π)
**–ö–∞–∫:** AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
**–Ø —Ö–æ—á—É:** –∏—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç–≤–µ—Ç–∞
**–ß—Ç–æ–±—ã:** –¥–∞–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ñ–∞–∫—Ç–∞–º–∏, –∞ –Ω–µ –¥–æ–≥–∞–¥–∫–∞–º–∏

**Acceptance Criteria:**
- ‚úÖ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–∞ AI —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é vector embeddings –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ù–∞—Ö–æ–∂—É —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –£–∫–∞–∑—ã–≤–∞—é –∏—Å—Ç–æ—á–Ω–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–≥–ª–∞—Å–Ω–æ FAQ: ...")

**Story Points:** 8 SP (1 –Ω–µ–¥–µ–ª—è)

---

### US-039: –ü–æ–∫—É–ø–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –ø–æ–∫—É–ø–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI
**–ß—Ç–æ–±—ã:** –ø–ª–∞—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**Acceptance Criteria:**
- ‚úÖ –í–∏–∂—É –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ –≤ UI
- ‚úÖ –ú–æ–≥—É –∫—É–ø–∏—Ç—å —Ç–æ–∫–µ–Ω—ã: 1,000‚ÇΩ = 20,000 —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –í–∏–∂—É —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–ª—É—á–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è (< 1,000)
- ‚úÖ –ú–æ–≥—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

### US-040: –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
**–ö–∞–∫:** AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
**–Ø —Ö–æ—á—É:** –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
**–ß—Ç–æ–±—ã:** —É–ª—É—á—à–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤

**Acceptance Criteria:**
- ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–µ–≥–æ–º "successful"
- ‚úÖ –ò–∑–≤–ª–µ–∫–∞—é —Ç–∏–ø–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é –≤ FAQ –±–∞–∑—É (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞)
- ‚úÖ –í–∏–∂—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: —Å–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö FAQ –¥–æ–±–∞–≤–ª–µ–Ω–æ

**Story Points:** 2 SP (1-2 –¥–Ω—è)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Firestore Schema

```typescript
// stores/{storeId}/aiAssistant
interface AIAssistant {
  storeId: string;

  // Knowledge Base
  knowledgeBase: {
    faq: Array<{
      id: string;
      question: string;
      answer: string;
      tags: string[];
      source: 'manual' | 'google_sheets' | 'auto_generated';
      createdAt: Timestamp;
    }>;

    policies: {
      shipping: string; // –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
      returns: string; // –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
      warranty: string; // –ì–∞—Ä–∞–Ω—Ç–∏—è
    };

    // –ê–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
    productsIndexed: boolean;
    lastProductSyncAt?: Timestamp;
  };

  // AI Settings
  settings: {
    tone: 'formal' | 'friendly' | 'professional';
    language: 'ru' | 'en' | 'bilingual';
    signature: string; // –ü–æ–¥–ø–∏—Å—å
    forbiddenTopics: string[]; // –û —á–µ–º –Ω–µ –æ—Ç–≤–µ—á–∞–µ–º
    brandPhrases: string[]; // –§–∏—Ä–º–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
  };

  // Token Usage
  tokenBalance: number; // –û—Å—Ç–∞—Ç–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤
  tokenUsage: {
    today: number;
    thisMonth: number;
    total: number;
  };
  autoPurchase: {
    enabled: boolean;
    threshold: number; // –ö—É–ø–∏—Ç—å –∫–æ–≥–¥–∞ < threshold
    amount: number; // –°—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏ (‚ÇΩ)
  };

  // Metadata
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// stores/{storeId}/tokenTransactions/{txId}
interface TokenTransaction {
  storeId: string;
  type: 'purchase' | 'usage' | 'refund';
  amount: number; // –ö–æ–ª-–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
  cost?: number; // –°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)
  description: string; // "–û—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤" / "–ü–æ–∫—É–ø–∫–∞ 20k —Ç–æ–∫–µ–Ω–æ–≤"
  balance: number; // –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  createdAt: Timestamp;
}
```

### RAG Implementation (Vector Search)

```typescript
// src/ai/rag-assistant.ts

import { OpenAI } from 'openai';
import { firestore } from '@/firebase/config';
import { cosineSimilarity } from '@/lib/math-utils';

interface RAGResult {
  answer: string;
  sources: string[];
  tokensUsed: number;
}

export async function answerWithRAG(
  storeId: string,
  question: string
): Promise<RAGResult> {

  // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
  const assistantDoc = await firestore
    .collection('stores').doc(storeId)
    .collection('aiAssistant').doc('config')
    .get();

  const assistant = assistantDoc.data();
  const { knowledgeBase, settings } = assistant;

  // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
  const questionEmbedding = await generateEmbedding(question);

  // 3. –ò—â–µ–º —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö FAQ
  const faqWithScores = await Promise.all(
    knowledgeBase.faq.map(async (faq) => {
      const faqEmbedding = await generateEmbedding(faq.question);
      const similarity = cosineSimilarity(questionEmbedding, faqEmbedding);
      return { faq, similarity };
    })
  );

  const topFAQs = faqWithScores
    .sort((a, b) => b.similarity - a.similarity)
    .slice(0, 3)
    .filter(item => item.similarity > 0.7); // –¢–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ

  // 4. –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI
  const context = topFAQs.length > 0
    ? `–°–æ–≥–ª–∞—Å–Ω–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω–∞:\n${topFAQs.map(item =>
        `Q: ${item.faq.question}\nA: ${item.faq.answer}`
      ).join('\n\n')}`
    : '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.';

  // 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const prompt = `
–¢—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ Wildberries.

–°—Ç–∏–ª—å: ${settings.tone}
–ü–æ–¥–ø–∏—Å—å: ${settings.signature}
–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–º—ã: ${settings.forbiddenTopics.join(', ')}

–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
${context}

–í–æ–ø—Ä–æ—Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è: "${question}"

–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —Å–∫–∞–∂–∏ —á—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞.
`;

  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [{ role: 'user', content: prompt }],
    temperature: 0.7,
    max_tokens: 300,
  });

  const answer = response.choices[0].message.content;
  const tokensUsed = response.usage.total_tokens;

  // 6. –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤
  await deductTokens(storeId, tokensUsed, `–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: ${question.substring(0, 50)}`);

  return {
    answer,
    sources: topFAQs.map(item => item.faq.question),
    tokensUsed,
  };
}

async function generateEmbedding(text: string): Promise<number[]> {
  const response = await openai.embeddings.create({
    model: 'text-embedding-3-small',
    input: text,
  });

  return response.data[0].embedding;
}

async function deductTokens(storeId: string, tokens: number, description: string) {
  const assistantRef = firestore
    .collection('stores').doc(storeId)
    .collection('aiAssistant').doc('config');

  await firestore.runTransaction(async (transaction) => {
    const doc = await transaction.get(assistantRef);
    const currentBalance = doc.data().tokenBalance;
    const newBalance = currentBalance - tokens;

    if (newBalance < 0) {
      throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤');
    }

    transaction.update(assistantRef, {
      tokenBalance: newBalance,
      'tokenUsage.today': doc.data().tokenUsage.today + tokens,
      'tokenUsage.thisMonth': doc.data().tokenUsage.thisMonth + tokens,
      'tokenUsage.total': doc.data().tokenUsage.total + tokens,
    });

    // –õ–æ–≥–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    const txRef = firestore
      .collection('stores').doc(storeId)
      .collection('tokenTransactions').doc();

    transaction.set(txRef, {
      storeId,
      type: 'usage',
      amount: -tokens,
      description,
      balance: newBalance,
      createdAt: new Date(),
    });
  });
}
```

### UI Component

```tsx
// src/app/stores/[storeId]/ai-assistant/page.tsx

export default function AIAssistantPage({ params }: { params: { storeId: string } }) {
  return (
    <div className="p-6 space-y-6">
      <h1 className="text-3xl font-bold">AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞</h1>

      {/* –ë–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ */}
      <Card>
        <CardHeader>
          <CardTitle>–ë–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-3xl font-bold">12,450</p>
              <p className="text-sm text-muted-foreground">—Ç–æ–∫–µ–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å</p>
            </div>
            <Button>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</Button>
          </div>

          <div className="mt-4">
            <p className="text-sm">–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è: 580 —Ç–æ–∫–µ–Ω–æ–≤</p>
            <p className="text-sm">–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ: 8,200 —Ç–æ–∫–µ–Ω–æ–≤ (~410‚ÇΩ)</p>
          </div>
        </CardContent>
      </Card>

      {/* –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π */}
      <Card>
        <CardHeader>
          <CardTitle>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (FAQ)</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-2">
            {faqs.map(faq => (
              <div key={faq.id} className="border p-3 rounded">
                <p className="font-medium">{faq.question}</p>
                <p className="text-sm text-muted-foreground">{faq.answer}</p>
              </div>
            ))}
          </div>

          <div className="mt-4 flex gap-2">
            <Button>–î–æ–±–∞–≤–∏—Ç—å FAQ –≤—Ä—É—á–Ω—É—é</Button>
            <Button variant="outline">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Google Sheets</Button>
          </div>
        </CardContent>
      </Card>

      {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª—è */}
      <Card>
        <CardHeader>
          <CardTitle>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª—è</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <label>–¢–æ–Ω</label>
            <Select>
              <option value="formal">–§–æ—Ä–º–∞–ª—å–Ω—ã–π</option>
              <option value="friendly">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</option>
              <option value="professional">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π</option>
            </Select>
          </div>

          <div>
            <label>–ü–æ–¥–ø–∏—Å—å</label>
            <Input placeholder="–° –∑–∞–±–æ—Ç–æ–π, –∫–æ–º–∞–Ω–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞" />
          </div>

          <Button>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</Button>
        </CardContent>
      </Card>

      {/* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ */}
      <Card>
        <CardHeader>
          <CardTitle>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI</CardTitle>
        </CardHeader>
        <CardContent>
          <Textarea placeholder="–ó–∞–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å..." rows={3} />
          <Button className="mt-2">–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç</Button>

          <div className="mt-4 bg-gray-50 p-3 rounded">
            <p className="text-sm font-medium">–û—Ç–≤–µ—Ç AI:</p>
            <p className="text-sm mt-1">[–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç]</p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**KPIs:**
- üéØ –¢–æ—á–Ω–æ—Å—Ç—å AI –æ—Ç–≤–µ—Ç–æ–≤: > 85% (–ø–æ feedback)
- üí∞ –°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤: 5,000‚ÇΩ/–º–∞–≥–∞–∑–∏–Ω –≤ –º–µ—Å—è—Ü
- ‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤: 10 —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é
- üìà Adoption rate: 60%+ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

**–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è:**
- Target LTV: 5,000‚ÇΩ/–º–∞–≥–∞–∑–∏–Ω –≤ –º–µ—Å—è—Ü (—Ç–æ–∫–µ–Ω—ã)
- –ü—Ä–∏ 8,000 –∫–ª–∏–µ–Ω—Ç–æ–≤ √ó 60% adoption √ó 5,000‚ÇΩ = **24M‚ÇΩ/–º–µ—Å—è—Ü** –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–í–Ω–µ—à–Ω–∏–µ:**
- OpenAI API (GPT-4 + Embeddings)
- Vector database (Pinecone –∏–ª–∏ Firestore)
- –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (Stripe/–ÆKassa)

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:**
- Existing knowledge base (FAQ, products)
- EPIC-017 (Google Sheets sync)
- EPIC-018 (Auto-FAQ generation)

---

## Risks & Mitigation

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å OpenAI | –í—ã—Å–æ–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Deepseek (–≤ 10x –¥–µ—à–µ–≤–ª–µ) |
| –ù–∏–∑–∫–∞—è adoption (–Ω–µ –ø–æ–∫—É–ø–∞—é—Ç —Ç–æ–∫–µ–Ω—ã) | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Free tier (1,000 —Ç–æ–∫–µ–Ω–æ–≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ), demo |
| AI –¥–∞–µ—Ç –Ω–µ—Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | RAG + –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, confidence threshold |

---

## Timeline

**Week 1-2:**
- Firestore schema –¥–ª—è Knowledge Base
- UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è FAQ
- Google Sheets integration

**Week 3-4:**
- RAG implementation (vector search)
- OpenAI integration
- Token deduction logic

**Week 5:**
- UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç–∏–ª—è –∏ —Ç–æ–Ω–∞
- Testing interface
- Token purchase flow (Stripe)

**Week 6:**
- Auto-learning from dialogues
- Analytics dashboard
- Production rollout

---

## –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**–ú–æ–¥–µ–ª—å: Pay-per-token**
- 1,000 —Ç–æ–∫–µ–Ω–æ–≤ = 50‚ÇΩ
- –ü–∞–∫–µ—Ç—ã:
  - Starter: 1,000‚ÇΩ = 20,000 —Ç–æ–∫–µ–Ω–æ–≤
  - Pro: 5,000‚ÇΩ = 120,000 —Ç–æ–∫–µ–Ω–æ–≤ (+20% bonus)
  - Enterprise: 20,000‚ÇΩ = 500,000 —Ç–æ–∫–µ–Ω–æ–≤ (+25% bonus)

**Revenue Projection:**
- 8,000 –∫–ª–∏–µ–Ω—Ç–æ–≤ √ó 60% adoption = 4,800 –∞–∫—Ç–∏–≤–Ω—ã—Ö
- 4,800 √ó 5,000‚ÇΩ/–º–µ—Å—è—Ü = **24M‚ÇΩ/–º–µ—Å—è—Ü** = **$300k/–º–µ—Å—è—Ü**

**–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ $100 –ø–æ–¥–ø–∏—Å–∫–µ:**
- $100/–º–µ—Å—è—Ü √ó 8,000 = $800k/–º–µ—Å—è—Ü (subscription)
- $300k/–º–µ—Å—è—Ü (tokens)
- **Total: $1.1M/–º–µ—Å—è—Ü**

---

## Definition of Done

- ‚úÖ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è FAQ (–¥–æ–±–∞–≤–∏—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª–∏—Ç—å)
- ‚úÖ Google Sheets sync –¥–ª—è FAQ
- ‚úÖ –ê–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ WB API
- ‚úÖ RAG implementation —Å vector search
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª—è, —Ç–æ–Ω–∞, –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ Token purchase flow (Stripe)
- ‚úÖ Token deduction –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ AI
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ
- ‚úÖ Testing interface –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ AI
- ‚úÖ Analytics: —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤, –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- ‚úÖ Auto-learning from successful dialogues
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 10+ –º–∞–≥–∞–∑–∏–Ω–∞—Ö

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–≤—å—é:** Sprint Planning Q3 2025
