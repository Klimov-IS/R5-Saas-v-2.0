# EPIC-018: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è FAQ –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤

**–°—Ç–∞—Ç—É—Å:** üìã Backlog
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3 (–ù–∏–∑–∫–∏–π)
**RICE Score:** 26.25
**–ö–≤–∞—Ä—Ç–∞–ª:** Q3 2025 (–ê–≤–≥—É—Å—Ç - –°–µ–Ω—Ç—è–±—Ä—å)
**–û—Ü–µ–Ω–∫–∞:** 8 –Ω–µ–¥–µ–ª—å (35 SP)
**–í–ª–∞–¥–µ–ª–µ—Ü:** Product Manager

---

## –ü—Ä–æ–±–ª–µ–º–∞

**–°–æ–∑–¥–∞–Ω–∏–µ FAQ –≤—Ä—É—á–Ω—É—é ‚Äî —Ç—Ä—É–¥–æ–µ–º–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤–æ–ø—Ä–æ—Å—ã –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑
- –ù—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –≤—Å–µ —Ç–∏–ø–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- FAQ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç (–Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏)
- –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

**–ü–æ—Ç–µ—Ä—è–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å:**
- –í –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —É–∂–µ –µ—Å—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã
- 80% –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è
- –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

---

## –†–µ—à–µ–Ω–∏–µ

AI-—Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏ (—Ç–µ–≥ "successful")
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
3. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≤–æ–ø—Ä–æ—Å—ã
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç FAQ –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
5. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É –º–∞–≥–∞–∑–∏–Ω–∞ –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- NLP –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤
- Clustering –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±–æ–±—â–µ–Ω–Ω—ã—Ö FAQ
- Human-in-the-loop (–æ–¥–æ–±—Ä–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º)

---

## User Stories

### US-041: –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
**–ö–∞–∫:** AI-—Å–∏—Å—Ç–µ–º–∞
**–Ø —Ö–æ—á—É:** –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
**–ß—Ç–æ–±—ã:** –Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

**Acceptance Criteria:**
- ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤—Å–µ —á–∞—Ç—ã —Å —Ç–µ–≥–æ–º "successful"
- ‚úÖ –ò–∑–≤–ª–µ–∫–∞—é –≤–æ–ø—Ä–æ—Å—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (—Ñ–∏–ª—å—Ç—Ä—É—é —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤)
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä—É—é –ø–æ—Ö–æ–∂–∏–µ –≤–æ–ø—Ä–æ—Å—ã (semantic similarity)
- ‚úÖ –í–∏–∂—É —Ç–æ–ø-20 —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

**Story Points:** 13 SP (2 –Ω–µ–¥–µ–ª–∏)

---

### US-042: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è FAQ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
**–ö–∞–∫:** AI-—Å–∏—Å—Ç–µ–º–∞
**–Ø —Ö–æ—á—É:** –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±–æ–±—â–µ–Ω–Ω—ã–µ FAQ –∏–∑ –≥—Ä—É–ø–ø –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
**–ß—Ç–æ–±—ã:** —Å–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –±–∞–∑—É –∑–Ω–∞–Ω–∏–π

**Acceptance Criteria:**
- ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é –æ–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- ‚úÖ –ù–∞—Ö–æ–∂—É –ª—É—á—à–∏–π –æ—Ç–≤–µ—Ç –∏–∑ —É—Å–ø–µ—à–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É—é FAQ entry (–≤–æ–ø—Ä–æ—Å + –æ—Ç–≤–µ—Ç + —Ç–µ–≥–∏)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é –≤ staging (–Ω–µ –ø—É–±–ª–∏–∫—É—é —Å—Ä–∞–∑—É)

**Story Points:** 13 SP (2 –Ω–µ–¥–µ–ª–∏)

---

### US-043: –û–¥–æ–±—Ä–µ–Ω–∏–µ FAQ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –º–∞–≥–∞–∑–∏–Ω–∞
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –æ–¥–æ–±—Ä—è—Ç—å –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ FAQ
**–ß—Ç–æ–±—ã:** –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

**Acceptance Criteria:**
- ‚úÖ –í–∏–∂—É —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö FAQ (–≤–æ–ø—Ä–æ—Å + –æ—Ç–≤–µ—Ç)
- ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–≥–æ FAQ –≤–∏–∂—É: —á–∞—Å—Ç–æ—Ç–∞ (—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è), –∏—Å—Ç–æ—á–Ω–∏–∫ (–¥–∏–∞–ª–æ–≥–∏)
- ‚úÖ –ú–æ–≥—É –æ–¥–æ–±—Ä–∏—Ç—å (–¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π)
- ‚úÖ –ú–æ–≥—É –æ—Ç–∫–ª–æ–Ω–∏—Ç—å (–Ω–µ –¥–æ–±–∞–≤–∏—Ç—Å—è)
- ‚úÖ –ú–æ–≥—É –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –æ–¥–æ–±—Ä–µ–Ω–∏–µ–º

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

### US-044: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ FAQ
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FAQ
**–ß—Ç–æ–±—ã:** –ø–æ–Ω–∏–º–∞—Ç—å –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ

**Acceptance Criteria:**
- ‚úÖ –í–∏–∂—É —Ç–æ–ø-10 FAQ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –í–∏–∂—É —Ç—Ä–µ–Ω–¥—ã: –Ω–æ–≤—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- ‚úÖ –ü–æ–ª—É—á–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: "–ù–æ–≤—ã–π —á–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω"
- ‚úÖ –ú–æ–≥—É —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å FAQ –≤ PDF/Excel

**Story Points:** 4 SP (2-3 –¥–Ω—è)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cloud Function (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. –ó–∞–≥—Ä—É–∂–∞–µ–º successful chats –∑–∞ –Ω–µ–¥–µ–ª—é        ‚îÇ
‚îÇ  2. –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ (NLP)            ‚îÇ
‚îÇ  3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞   ‚îÇ
‚îÇ  4. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ–º –ø–æ—Ö–æ–∂–∏–µ –≤–æ–ø—Ä–æ—Å—ã (K-Means)      ‚îÇ
‚îÇ  5. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞:                       ‚îÇ
‚îÇ     - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å (LLM)        ‚îÇ
‚îÇ     - –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–π –æ—Ç–≤–µ—Ç (LLM)                ‚îÇ
‚îÇ     - –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ staging FAQ                   ‚îÇ
‚îÇ  6. –£–≤–µ–¥–æ–º–ª—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Firestore Schema

```typescript
// stores/{storeId}/faqSuggestions/{suggestionId}
interface FAQSuggestion {
  storeId: string;

  // Generated FAQ
  question: string; // –û–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
  answer: string; // –û–±–æ–±—â–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
  tags: string[]; // –¢–µ–≥–∏ (—Ç–æ–≤–∞—Ä, –¥–æ—Å—Ç–∞–≤–∫–∞, –≤–æ–∑–≤—Ä–∞—Ç, ...)

  // Metadata
  frequency: number; // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è
  confidence: number; // 0.0-1.0
  sourceDialogues: string[]; // ID –¥–∏–∞–ª–æ–≥–æ–≤, –æ—Ç–∫—É–¥–∞ –∏–∑–≤–ª–µ—á–µ–Ω–æ

  // Status
  status: 'pending' | 'approved' | 'rejected';
  reviewedBy?: string; // UID –≤–ª–∞–¥–µ–ª—å—Ü–∞
  reviewedAt?: Timestamp;

  createdAt: Timestamp;
}

// stores/{storeId}/faqAnalytics/{date}
interface FAQAnalytics {
  storeId: string;
  date: Timestamp; // –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞

  // Stats
  totalDialoguesAnalyzed: number;
  questionsExtracted: number;
  clustersFound: number;
  faqGenerated: number;

  // Top Questions
  topQuestions: Array<{
    question: string;
    frequency: number;
    cluster: number;
  }>;

  // Execution time
  processingTimeMs: number;
}
```

### Cloud Function Implementation

```typescript
// functions/src/scheduled/generate-faq.ts

import * as functions from 'firebase-functions';
import { firestore } from '../firebase-admin';
import { extractQuestions, clusterQuestions, generateFAQ } from '../ai/faq-generator';

export const scheduledFAQGeneration = functions.pubsub
  .schedule('every sunday 03:00')
  .timeZone('Europe/Moscow')
  .onRun(async (context) => {
    const stores = await firestore.collection('stores').get();

    for (const storeDoc of stores.docs) {
      const storeId = storeDoc.id;

      try {
        await generateFAQForStore(storeId);
      } catch (error) {
        console.error(`Store ${storeId}: FAQ generation failed`, error);
      }
    }

    return null;
  });

async function generateFAQForStore(storeId: string) {
  const startTime = Date.now();

  // 1. –ü–æ–ª—É—á–∞–µ–º —É—Å–ø–µ—à–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
  const oneWeekAgo = new Date();
  oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

  const chatsQuery = firestore
    .collectionGroup('chats')
    .where('storeId', '==', storeId)
    .where('tag', '==', 'successful')
    .where('updatedAt', '>=', oneWeekAgo);

  const chatsSnapshot = await chatsQuery.get();

  if (chatsSnapshot.empty) {
    console.log(`Store ${storeId}: No successful chats this week`);
    return;
  }

  // 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤
  const allQuestions: Array<{ chatId: string, text: string }> = [];

  for (const chatDoc of chatsSnapshot.docs) {
    const messagesSnapshot = await chatDoc.ref.collection('messages')
      .where('sender', '==', 'user')
      .get();

    const questions = messagesSnapshot.docs.map(msgDoc => ({
      chatId: chatDoc.id,
      text: msgDoc.data().text,
    }));

    allQuestions.push(...questions);
  }

  console.log(`Store ${storeId}: Extracted ${allQuestions.length} questions`);

  // 3. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ–º –ø–æ—Ö–æ–∂–∏–µ –≤–æ–ø—Ä–æ—Å—ã
  const clusters = await clusterQuestions(allQuestions);

  console.log(`Store ${storeId}: Found ${clusters.length} question clusters`);

  // 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º FAQ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
  for (const cluster of clusters) {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã (< 3 –≤–æ–ø—Ä–æ—Å–æ–≤)
    if (cluster.questions.length < 3) {
      continue;
    }

    const faq = await generateFAQ(cluster.questions, storeId);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ suggestion
    await firestore
      .collection('stores').doc(storeId)
      .collection('faqSuggestions').add({
        storeId,
        question: faq.question,
        answer: faq.answer,
        tags: faq.tags,
        frequency: cluster.questions.length,
        confidence: faq.confidence,
        sourceDialogues: cluster.questions.map(q => q.chatId),
        status: 'pending',
        createdAt: new Date(),
      });
  }

  // 5. –õ–æ–≥–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  await firestore
    .collection('stores').doc(storeId)
    .collection('faqAnalytics').add({
      storeId,
      date: new Date(),
      totalDialoguesAnalyzed: chatsSnapshot.size,
      questionsExtracted: allQuestions.length,
      clustersFound: clusters.length,
      faqGenerated: clusters.filter(c => c.questions.length >= 3).length,
      processingTimeMs: Date.now() - startTime,
    });

  // 6. –£–≤–µ–¥–æ–º–ª—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
  await notifyStoreOwner(storeId, clusters.length);
}
```

### AI Logic for Clustering & FAQ Generation

```typescript
// src/ai/faq-generator.ts

import { deepseek } from '@/lib/deepseek-client';
import { generateEmbedding, cosineSimilarity } from '@/lib/embeddings';

interface Question {
  chatId: string;
  text: string;
}

interface Cluster {
  id: number;
  questions: Question[];
  centroid: number[]; // Embedding centroid
}

export async function clusterQuestions(questions: Question[]): Promise<Cluster[]> {
  // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
  const embeddings = await Promise.all(
    questions.map(q => generateEmbedding(q.text))
  );

  // 2. K-Means clustering (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
  const K = Math.min(10, Math.floor(questions.length / 5)); // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ K
  const clusters: Cluster[] = [];

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (—Å–ª—É—á–∞–π–Ω—ã–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã)
  for (let i = 0; i < K; i++) {
    clusters.push({
      id: i,
      questions: [],
      centroid: embeddings[Math.floor(Math.random() * embeddings.length)],
    });
  }

  // –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
  for (let iter = 0; iter < 10; iter++) {
    // Reset clusters
    clusters.forEach(c => c.questions = []);

    // Assign to nearest cluster
    questions.forEach((q, idx) => {
      const embedding = embeddings[idx];
      let maxSimilarity = -1;
      let bestCluster = 0;

      clusters.forEach((cluster, clusterIdx) => {
        const similarity = cosineSimilarity(embedding, cluster.centroid);
        if (similarity > maxSimilarity) {
          maxSimilarity = similarity;
          bestCluster = clusterIdx;
        }
      });

      clusters[bestCluster].questions.push(q);
    });

    // Recompute centroids
    clusters.forEach(cluster => {
      if (cluster.questions.length > 0) {
        const clusterEmbeddings = cluster.questions.map(q =>
          embeddings[questions.indexOf(q)]
        );

        // Average embedding
        cluster.centroid = clusterEmbeddings[0].map((_, dim) =>
          clusterEmbeddings.reduce((sum, emb) => sum + emb[dim], 0) / clusterEmbeddings.length
        );
      }
    });
  }

  // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
  return clusters.filter(c => c.questions.length > 0);
}

export async function generateFAQ(
  questions: Question[],
  storeId: string
): Promise<{ question: string; answer: string; tags: string[]; confidence: number }> {

  // –ë–µ—Ä–µ–º —Ç–æ–ø-5 —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞
  const sampleQuestions = questions.slice(0, 5).map(q => q.text);

  const prompt = `
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ FAQ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –æ–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä—É–ø–ø—ã –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.

–í–æ–ø—Ä–æ—Å—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
${sampleQuestions.map((q, i) => `${i + 1}. ${q}`).join('\n')}

–ó–∞–¥–∞–Ω–∏–µ:
1. –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –æ–¥–∏–Ω –æ–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã
2. –ù–∞–ø–∏—à–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
3. –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–µ–≥–∏ (—Ç–æ–≤–∞—Ä, –¥–æ—Å—Ç–∞–≤–∫–∞, –≤–æ–∑–≤—Ä–∞—Ç, –æ–ø–ª–∞—Ç–∞, —Ä–∞–∑–º–µ—Ä, –∫–∞—á–µ—Å—Ç–≤–æ)

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "question": "–û–±–æ–±—â–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å",
  "answer": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
  "tags": ["—Ç–µ–≥1", "—Ç–µ–≥2"],
  "confidence": 0.0-1.0
}
`;

  const response = await deepseek.chat.completions.create({
    model: 'deepseek-chat',
    messages: [{ role: 'user', content: prompt }],
    response_format: { type: 'json_object' },
    temperature: 0.5,
  });

  const result = JSON.parse(response.choices[0].message.content);

  return {
    question: result.question,
    answer: result.answer,
    tags: result.tags || [],
    confidence: result.confidence || 0.7,
  };
}
```

### UI Component

```tsx
// src/app/stores/[storeId]/faq-suggestions/page.tsx

export default async function FAQSuggestionsPage({ params }: { params: { storeId: string } }) {
  const suggestions = await getFAQSuggestions(params.storeId);

  return (
    <div className="p-6 space-y-6">
      <h1 className="text-3xl font-bold">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ FAQ</h1>

      <div className="space-y-4">
        {suggestions.map(suggestion => (
          <Card key={suggestion.id}>
            <CardContent className="p-4">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <p className="font-medium text-lg">{suggestion.question}</p>
                  <p className="text-sm text-muted-foreground mt-1">{suggestion.answer}</p>

                  <div className="flex gap-2 mt-2">
                    {suggestion.tags.map(tag => (
                      <Badge key={tag} variant="secondary">{tag}</Badge>
                    ))}
                  </div>

                  <p className="text-xs text-muted-foreground mt-2">
                    –í—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å {suggestion.frequency} —Ä–∞–∑ | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {(suggestion.confidence * 100).toFixed(0)}%
                  </p>
                </div>

                <div className="flex gap-2">
                  <Button
                    size="sm"
                    onClick={() => approveFAQ(suggestion.id)}
                  >
                    ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
                  </Button>
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => rejectFAQ(suggestion.id)}
                  >
                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                  </Button>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**KPIs:**
- üéØ –¢–æ—á–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö FAQ: > 75% (approval rate)
- üìà –ö–æ–ª-–≤–æ FAQ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π: —Ä–æ—Å—Ç –Ω–∞ 300%
- ‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ FAQ: 5 —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é
- ü§ñ Adoption: 40%+ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç auto-FAQ

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ö–æ–ª-–≤–æ –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö FAQ/–Ω–µ–¥–µ–ª—é
- Approval vs rejection rate
- –¢–æ–ø-3 —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–í–Ω–µ—à–Ω–∏–µ:**
- Deepseek API –¥–ª—è NLP –∏ generation
- OpenAI Embeddings –¥–ª—è semantic search
- K-Means clustering library

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:**
- EPIC-012 (AI Assistant —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π)
- Successful chats (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ç–µ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## Risks & Mitigation

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Human-in-the-loop (–æ–¥–æ–±—Ä–µ–Ω–∏–µ), confidence threshold |
| –ú–∞–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 50 —á–∞—Ç–æ–≤/–Ω–µ–¥–µ–ª—é, –∏–Ω–∞—á–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º |
| –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å AI | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –ó–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é (–Ω–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ) |

---

## Timeline

**Week 1-2:**
- NLP logic –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤
- Embeddings generation

**Week 3-4:**
- K-Means clustering implementation
- Testing –Ω–∞ sample data

**Week 5-6:**
- LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±–æ–±—â–µ–Ω–Ω—ã—Ö FAQ
- Firestore schema + Cloud Function

**Week 7:**
- UI –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è FAQ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI Assistant knowledge base

**Week 8:**
- Analytics dashboard
- Testing + rollout

---

## –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**–ù–µ –ø—Ä—è–º–æ–µ –≤–ª–∏—è–Ω–∏–µ**, –Ω–æ:
- –£–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (EPIC-012)
- –°–Ω–∏–∂–∞–µ—Ç churn –∑–∞ —Å—á–µ—Ç –ª—É—á—à–µ–≥–æ UX
- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç)

**Value Proposition:**
- "AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∏—Ç—Å—è –Ω–∞ –≤–∞—à–∏—Ö –¥–∏–∞–ª–æ–≥–∞—Ö"
- "FAQ –±–∞–∑–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–∞–º–∞, –±–µ–∑ –≤–∞—à–µ–≥–æ —É—á–∞—Å—Ç–∏—è"

---

## Definition of Done

- ‚úÖ Cloud Function –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç successful chats –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ Clustering –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (K-Means)
- ‚úÖ LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±–æ–±—â–µ–Ω–Ω—ã—Ö FAQ
- ‚úÖ Firestore schema –¥–ª—è FAQ suggestions
- ‚úÖ UI –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è FAQ
- ‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ FAQ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ AI Assistant knowledge base
- ‚úÖ Analytics: —á–∞—Å—Ç–æ—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤, —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É –æ –Ω–æ–≤—ã—Ö FAQ
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 100+ –¥–∏–∞–ª–æ–≥–∞—Ö
- ‚úÖ Approval rate > 70%

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–≤—å—é:** Sprint Planning Q3 2025
