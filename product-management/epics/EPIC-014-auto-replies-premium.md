# EPIC-014: –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã –∏ –≤–æ–ø—Ä–æ—Å—ã (Premium)

**–°—Ç–∞—Ç—É—Å:** üìã Backlog
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)
**RICE Score:** 67.5
**–ö–≤–∞—Ä—Ç–∞–ª:** Q2 2025 (–ú–∞–π - –ò—é–Ω—å)
**–û—Ü–µ–Ω–∫–∞:** 4 –Ω–µ–¥–µ–ª–∏ (18 SP)
**–í–ª–∞–¥–µ–ª–µ—Ü:** Product Manager

---

## –ü—Ä–æ–±–ª–µ–º–∞

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Ç–∑—ã–≤—ã:**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä —á–∏—Ç–∞–µ—Ç –æ—Ç–∑—ã–≤
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–æ—Ç–≤–µ—Ç (–Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É)
3. –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ WB –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Ä—É—á–Ω—É—é

**–ë–æ–ª—å:**
- –í—Å–µ –µ—â–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å-–≤—Å—Ç–∞–≤–∏—Ç—å)
- –ù—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- –ù–∞ 50 –æ—Ç–∑—ã–≤–æ–≤/–¥–µ–Ω—å —É—Ö–æ–¥–∏—Ç 1+ —á–∞—Å

**–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã:**
- –ü—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã, –ù–û —Ç–æ–ª—å–∫–æ –ø–æ —à–∞–±–ª–æ–Ω–∞–º (–±–µ–∑ AI)
- –ù–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: **AI + –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**

---

## –†–µ—à–µ–Ω–∏–µ

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã –∏ –≤–æ–ø—Ä–æ—Å—ã:
1. **–¢—Ä–∏–≥–≥–µ—Ä:** –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã/–≤–æ–ø—Ä–æ—Å—ã
2. **AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è:** —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–Ω–µ —à–∞–±–ª–æ–Ω—ã!)
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –æ—Ç–≤–µ—á–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ç–∑—ã–≤—ã 4-5‚òÖ (–∏–ª–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
4. **–ê–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞:** —á–µ—Ä–µ–∑ WB API
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –≤—Å–µ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

**–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è:**
- **Premium feature** (—Ç–æ–ª—å–∫–æ –≤ –ø–æ–¥–ø–∏—Å–∫–µ $100/–º–µ—Å—è—Ü)
- Killer feature –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: AI –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–æ–≤

---

## User Stories

### US-033: –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–ª–∞ –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
**–ß—Ç–æ–±—ã:** —ç–∫–æ–Ω–æ–º–∏—Ç—å –≤—Ä–µ–º—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—ã—Å–æ–∫–∏–π engagement

**Acceptance Criteria:**
- ‚úÖ –í–∫–ª—é—á–∞—é –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞
- ‚úÖ –í—ã–±–∏—Ä–∞—é —Ñ–∏–ª—å—Ç—Ä: —Ä–µ–π—Ç–∏–Ω–≥ ‚â• 4‚òÖ, –∏–ª–∏ –≤—Å–µ –æ—Ç–∑—ã–≤—ã
- ‚úÖ –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
- ‚úÖ AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–µ —à–∞–±–ª–æ–Ω!)
- ‚úÖ –û—Ç–≤–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WB API
- ‚úÖ –í–∏–∂—É –ª–æ–≥ –≤—Å–µ—Ö –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤ –≤ UI
- ‚úÖ –ú–æ–≥—É –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π

**Story Points:** 8 SP (1 –Ω–µ–¥–µ–ª—è)

---

### US-034: –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–ª–∞ –Ω–∞ —Ç–∏–ø–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
**–ß—Ç–æ–±—ã:** –Ω–µ —Ç–µ—Ä—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑-–∑–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**Acceptance Criteria:**
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é FAQ –±–∞–∑—É –¥–ª—è AI (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, –¥–æ—Å—Ç–∞–≤–∫–∞, –≤–æ–∑–≤—Ä–∞—Ç)
- ‚úÖ AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å > 0.8
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (confidence < 0.8) –ø–æ–º–µ—á–∞—é—Ç—Å—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –í–∏–∂—É –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –±—ã–ª–∏ –æ—Ç–≤–µ—á–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ú–æ–≥—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–µ–º—ã

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

### US-035: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–Ω–∞ –∏ —Å—Ç–∏–ª—è AI
**–ö–∞–∫:** –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
**–Ø —Ö–æ—á—É:** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–Ω –∏ —Å—Ç–∏–ª—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥ —Å–≤–æ–π –±—Ä–µ–Ω–¥
**–ß—Ç–æ–±—ã:** –æ—Ç–≤–µ—Ç—ã –≤—ã–≥–ª—è–¥–µ–ª–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∏–º–∏–¥–∂—É –º–∞–≥–∞–∑–∏–Ω–∞

**Acceptance Criteria:**
- ‚úÖ –í—ã–±–∏—Ä–∞—é —Å—Ç–∏–ª—å: —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –∫—Ä–∞—Ç–∫–∏–π, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π
- ‚úÖ –î–æ–±–∞–≤–ª—è—é —Ñ–∏—Ä–º–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–° –∑–∞–±–æ—Ç–æ–π, –∫–æ–º–∞–Ω–¥–∞ X")
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞/—Ñ—Ä–∞–∑—ã
- ‚úÖ Preview: –≤–∏–∂—É –ø—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ
- ‚úÖ AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**Story Points:** 5 SP (3-5 –¥–Ω–µ–π)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Firestore Schema

```typescript
// stores/{storeId}/settings
interface StoreSettings {
  // ... existing fields

  autoReplies: {
    enabled: boolean;
    reviews: {
      enabled: boolean;
      minRating: 1 | 2 | 3 | 4 | 5; // –û—Ç–≤–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ç–∑—ã–≤—ã ‚â• —ç—Ç–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
      maxPerDay: number; // –õ–∏–º–∏—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤/–¥–µ–Ω—å (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
    };
    questions: {
      enabled: boolean;
      confidenceThreshold: number; // 0.0-1.0, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–∞
    };

    // –°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤
    tone: 'formal' | 'friendly' | 'brief' | 'detailed';
    signature: string; // –ü–æ–¥–ø–∏—Å—å –≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞
    forbiddenWords: string[]; // –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞

    // FAQ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
    faqKnowledge: Array<{
      question: string;
      answer: string;
      tags: string[];
    }>;
  };
}

// stores/{storeId}/autoReplyLogs/{logId}
interface AutoReplyLog {
  storeId: string;
  type: 'review' | 'question';

  // –û—Ä–∏–≥–∏–Ω–∞–ª
  itemId: string; // reviewId –∏–ª–∏ questionId
  originalText: string;
  rating?: number; // –î–ª—è –æ—Ç–∑—ã–≤–æ–≤

  // AI –æ—Ç–≤–µ—Ç
  generatedReply: string;
  confidence: number;
  sentToWB: boolean;

  // Metadata
  generatedAt: Timestamp;
  sentAt?: Timestamp;
  error?: string;
}
```

### Cloud Function –¥–ª—è –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤

```typescript
// functions/src/scheduled/auto-reply-reviews.ts

import * as functions from 'firebase-functions';
import { firestore } from '../firebase-admin';
import { generateReviewReply } from '../ai/generate-review-reply';
import { sendReplyToWB } from '../wb/send-reply';

export const scheduledAutoReplies = functions.pubsub
  .schedule('every 30 minutes')
  .timeZone('Europe/Moscow')
  .onRun(async (context) => {
    const stores = await firestore.collection('stores').get();

    for (const storeDoc of stores.docs) {
      const settings = storeDoc.data().settings;

      if (!settings?.autoReplies?.enabled) {
        continue;
      }

      try {
        // –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã
        if (settings.autoReplies.reviews.enabled) {
          await processAutoRepliesForStore(storeDoc.id, settings);
        }

        // –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
        if (settings.autoReplies.questions.enabled) {
          await processAutoAnswersForStore(storeDoc.id, settings);
        }

      } catch (error) {
        console.error(`Store ${storeDoc.id}: Auto-reply failed`, error);
      }

      // Rate limiting
      await new Promise(resolve => setTimeout(resolve, 500));
    }

    return null;
  });

async function processAutoRepliesForStore(storeId: string, settings: any) {
  const now = new Date();
  const thirtyMinutesAgo = new Date(now.getTime() - 30 * 60 * 1000);

  // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç
  const reviewsQuery = firestore
    .collectionGroup('reviews')
    .where('storeId', '==', storeId)
    .where('rating', '>=', settings.autoReplies.reviews.minRating)
    .where('date', '>=', thirtyMinutesAgo)
    .where('date', '<=', now)
    .where('replied', '==', false); // –¢–æ–ª—å–∫–æ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞

  const reviewsSnapshot = await reviewsQuery.get();

  // –õ–∏–º–∏—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤ –≤ –¥–µ–Ω—å
  const todayCount = await getAutoReplyCountToday(storeId);
  const maxPerDay = settings.autoReplies.reviews.maxPerDay || 100;

  let sentCount = 0;

  for (const reviewDoc of reviewsSnapshot.docs) {
    if (todayCount + sentCount >= maxPerDay) {
      console.log(`Store ${storeId}: Daily limit reached (${maxPerDay})`);
      break;
    }

    const review = reviewDoc.data();

    try {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º AI-–æ—Ç–≤–µ—Ç
      const reply = await generateReviewReply(
        review.text,
        review.rating,
        settings.autoReplies.tone,
        settings.autoReplies.signature
      );

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ WB
      await sendReplyToWB(storeId, review.wbReviewId, reply.text);

      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–∑—ã–≤
      await reviewDoc.ref.update({
        replied: true,
        replyText: reply.text,
        repliedAt: new Date(),
        autoReplied: true,
      });

      // –õ–æ–≥–∏—Ä—É–µ–º
      await firestore
        .collection('stores').doc(storeId)
        .collection('autoReplyLogs').add({
          storeId,
          type: 'review',
          itemId: reviewDoc.id,
          originalText: review.text,
          rating: review.rating,
          generatedReply: reply.text,
          confidence: reply.confidence,
          sentToWB: true,
          generatedAt: new Date(),
          sentAt: new Date(),
        });

      sentCount++;

    } catch (error) {
      console.error(`Failed to auto-reply to review ${reviewDoc.id}:`, error);

      await firestore
        .collection('stores').doc(storeId)
        .collection('autoReplyLogs').add({
          storeId,
          type: 'review',
          itemId: reviewDoc.id,
          originalText: review.text,
          generatedReply: '',
          confidence: 0,
          sentToWB: false,
          error: error.message,
          generatedAt: new Date(),
        });
    }

    // Rate limiting
    await new Promise(resolve => setTimeout(resolve, 200));
  }

  console.log(`Store ${storeId}: Sent ${sentCount} auto-replies`);
}

async function getAutoReplyCountToday(storeId: string): Promise<number> {
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const logsSnapshot = await firestore
    .collection('stores').doc(storeId)
    .collection('autoReplyLogs')
    .where('generatedAt', '>=', today)
    .where('sentToWB', '==', true)
    .get();

  return logsSnapshot.size;
}
```

### AI Generation Logic

```typescript
// src/ai/generate-review-reply.ts

import { deepseek } from '@/lib/deepseek-client';

interface ReplyResult {
  text: string;
  confidence: number;
}

export async function generateReviewReply(
  reviewText: string,
  rating: number,
  tone: string,
  signature: string
): Promise<ReplyResult> {

  const toneInstructions = {
    formal: '–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å, –∏–∑–±–µ–≥–∞–π —Å–ª–µ–Ω–≥–∞',
    friendly: '–ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ',
    brief: '–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–º (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)',
    detailed: '–î–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç (3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)',
  };

  const prompt = `
–¢—ã ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ Wildberries. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è.

–û—Ç–∑—ã–≤ (${rating}‚òÖ): "${reviewText}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- ${toneInstructions[tone]}
- –ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏ –∑–∞ –æ—Ç–∑—ã–≤
- ${rating >= 4 ? '–í—ã—Ä–∞–∑–∏ —Ä–∞–¥–æ—Å—Ç—å, —á—Ç–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å' : '–ò–∑–≤–∏–Ω–∏—Å—å –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ'}
- –ë—É–¥—å –∏—Å–∫—Ä–µ–Ω–Ω–∏–º, –∏–∑–±–µ–≥–∞–π —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
- –ù–µ —É–ø–æ–º–∏–Ω–∞–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- –î–ª–∏–Ω–∞: 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

–ü–æ–¥–ø–∏—Å—å –≤ –∫–æ–Ω—Ü–µ: "${signature}"

–û—Ç–≤–µ—Ç:
`;

  const response = await deepseek.chat.completions.create({
    model: 'deepseek-chat',
    messages: [{ role: 'user', content: prompt }],
    temperature: 0.7,
    max_tokens: 200,
  });

  const replyText = response.choices[0].message.content.trim();

  // –ü—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –¥–ª—è confidence
  const confidence = replyText.length > 20 && replyText.length < 300 ? 0.9 : 0.6;

  return {
    text: replyText,
    confidence,
  };
}
```

### UI Component

```tsx
// src/app/stores/[storeId]/settings/AutoRepliesSettings.tsx

'use client';

import { Switch } from '@/components/ui/switch';
import { Select } from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export function AutoRepliesSettings({ storeId }: { storeId: string }) {
  const [enabled, setEnabled] = useState(false);
  const [minRating, setMinRating] = useState(4);
  const [tone, setTone] = useState('friendly');
  const [signature, setSignature] = useState('–° –∑–∞–±–æ—Ç–æ–π, –∫–æ–º–∞–Ω–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞');

  const handleSave = async () => {
    await updateDoc(doc(firestore, 'stores', storeId), {
      'settings.autoReplies': {
        enabled,
        reviews: {
          enabled,
          minRating,
          maxPerDay: 100,
        },
        tone,
        signature,
      },
    });
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle>–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã (Premium)</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="flex items-center justify-between">
          <label>–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã</label>
          <Switch checked={enabled} onCheckedChange={setEnabled} />
        </div>

        {enabled && (
          <>
            <div>
              <label>–û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º</label>
              <Select value={minRating} onValueChange={setMinRating}>
                <option value={5}>–¢–æ–ª—å–∫–æ 5‚òÖ</option>
                <option value={4}>4‚òÖ –∏ –≤—ã—à–µ</option>
                <option value={3}>3‚òÖ –∏ –≤—ã—à–µ</option>
                <option value={1}>–í—Å–µ –æ—Ç–∑—ã–≤—ã</option>
              </Select>
            </div>

            <div>
              <label>–°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤</label>
              <Select value={tone} onValueChange={setTone}>
                <option value="formal">–§–æ—Ä–º–∞–ª—å–Ω—ã–π</option>
                <option value="friendly">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</option>
                <option value="brief">–ö—Ä–∞—Ç–∫–∏–π</option>
                <option value="detailed">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π</option>
              </Select>
            </div>

            <div>
              <label>–ü–æ–¥–ø–∏—Å—å</label>
              <Input
                value={signature}
                onChange={(e) => setSignature(e.target.value)}
                placeholder="–° —É–≤–∞–∂–µ–Ω–∏–µ–º, ..."
              />
            </div>

            <div className="bg-blue-50 p-3 rounded border border-blue-200">
              ‚ÑπÔ∏è <strong>–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –≤ —Å—Ç–∏–ª–µ "{tone}":</strong>
              <p className="text-sm mt-2">
                {generateExampleReply(tone, signature)}
              </p>
            </div>
          </>
        )}

        <Button onClick={handleSave}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</Button>
      </CardContent>
    </Card>
  );
}

function generateExampleReply(tone: string, signature: string): string {
  const examples = {
    formal: `–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –í–∞—Å –∑–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–∑—ã–≤. –ú—ã —Ä–∞–¥—ã, —á—Ç–æ —Ç–æ–≤–∞—Ä —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –í–∞—à–∏–º –æ–∂–∏–¥–∞–Ω–∏—è–º. ${signature}`,
    friendly: `–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–µ–ø–ª—ã–µ —Å–ª–æ–≤–∞! üòä –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å! ${signature}`,
    brief: `–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤! ${signature}`,
    detailed: `–ë–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ —Ç–∞–∫–æ–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–∑—ã–≤! –ú—ã –æ—á–µ–Ω—å —Ü–µ–Ω–∏–º –≤–∞—à–µ –º–Ω–µ–Ω–∏–µ –∏ —Ä–∞–¥—ã, —á—Ç–æ —Ç–æ–≤–∞—Ä –≤–∞—Å –ø–æ—Ä–∞–¥–æ–≤–∞–ª. –ù–∞–¥–µ–µ–º—Å—è —É–≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞ —Å—Ä–µ–¥–∏ –Ω–∞—à–∏—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π! ${signature}`,
  };

  return examples[tone];
}
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**KPIs:**
- ‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: 1 —á–∞—Å/–¥–µ–Ω—å ‚Üí 5 –º–∏–Ω/–¥–µ–Ω—å (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤)
- üìà –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤: 30% ‚Üí 95%
- ‚ö° –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 24—á ‚Üí 30 –º–∏–Ω—É—Ç
- üí∞ Conversion –≤ Premium –ø–æ–¥–ø–∏—Å–∫—É: +40% (–∏–∑-–∑–∞ killer feature)

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ö–æ–ª-–≤–æ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤/–¥–µ–Ω—å
- Success rate –æ—Ç–ø—Ä–∞–≤–∫–∏ (% –±–µ–∑ –æ—à–∏–±–æ–∫)
- User satisfaction (–æ–ø—Ä–æ—Å—ã)

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–í–Ω–µ—à–Ω–∏–µ:**
- Wildberries API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
- Deepseek API –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:**
- Cloud Functions + Cloud Scheduler
- Existing reviews/questions architecture

---

## Risks & Mitigation

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| WB –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ | Rate limiting (100/–¥–µ–Ω—å), —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–¥–æ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (AI) |
| AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Preview mode (—Ç–µ—Å—Ç 30 –¥–Ω–µ–π), —Ä—É—á–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ |
| –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ "—Ä–æ–±–æ—Ç–æ–≤" | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ AI (–Ω–µ —à–∞–±–ª–æ–Ω—ã) |
| –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å AI | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –õ–∏–º–∏—Ç 100 –æ—Ç–≤–µ—Ç–æ–≤/–¥–µ–Ω—å, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ |

---

## Timeline

**Week 1-2:**
- Cloud Function –¥–ª—è –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã
- AI prompt optimization
- WB API integration

**Week 3:**
- –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- FAQ knowledge base

**Week 4:**
- UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—Ç–æ–Ω, —Å—Ç–∏–ª—å, –ø–æ–¥–ø–∏—Å—å)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Testing + rollout

---

## –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**–ö–ª—é—á–µ–≤–∞—è Premium —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è $100/–º–µ—Å—è—Ü –ø–æ–¥–ø–∏—Å–∫–∏:**
- –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã = **–≥–ª–∞–≤–Ω—ã–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ç–æ—Ä** vs –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã: —Ç–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω—ã
- –ú—ã: AI + –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è + –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

**Impact –Ω–∞ —Ü–µ–ª—å 8,000 –∫–ª–∏–µ–Ω—Ç–æ–≤:**
- Killer feature –¥–ª—è conversion
- Estimated: +30% signup rate

**Value Proposition:**
- "AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤—ã 24/7"
- "–≠–∫–æ–Ω–æ–º—å—Ç–µ 7+ —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é"
- "–£–≤–µ–ª–∏—á—å—Ç–µ engagement –Ω–∞ 200%"

---

## Definition of Done

- ‚úÖ Cloud Function –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- ‚úÖ AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–Ω–µ —à–∞–±–ª–æ–Ω—ã)
- ‚úÖ –ê–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WB API
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è)
- ‚úÖ –õ–∏–º–∏—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤/–¥–µ–Ω—å (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–Ω–∞, —Å—Ç–∏–ª—è, –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ FAQ –±–∞–∑–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ UI —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ UI —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 100+ –æ—Ç–∑—ã–≤–∞—Ö/–≤–æ–ø—Ä–æ—Å–∞—Ö
- ‚úÖ Feature flag –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ rollout

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–≤—å—é:** Sprint Planning Q2 2025
