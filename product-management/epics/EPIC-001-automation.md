# EPIC-001: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**Status:** üìÖ Planned
**Priority:** P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ)
**Quarter:** Q1 2025
**Owner:** Product Team
**RICE Score:** 750

---

## Problem Statement (–ü—Ä–æ–±–ª–µ–º–∞)

**–°–µ–π—á–∞—Å:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã **–≤—Ä—É—á–Ω—É—é –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫–∏** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤, —á–∞—Ç–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- ‚è∞ –ü–æ—Ç–µ—Ä–µ 8+ —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é –Ω–∞ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö
- üìâ –ó–∞–¥–µ—Ä–∂–∫–∞–º –≤ –æ—Ç–≤–µ—Ç–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞–º (24+ —á–∞—Å–∞)
- üò§ –†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üí∏ –°–Ω–∏–∂–µ–Ω–∏—é –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ—Ç–∑—ã–≤–æ–≤ ‚Üí –ø—Ä–æ–¥–∞–∂–∏

**–ü—Ä–∏–º–µ—Ä:**
> –ü—Ä–æ–¥–∞–≤–µ—Ü –¥–æ–ª–∂–µ–Ω –∑–∞—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞ –∏ –Ω–∞–∂–∏–º–∞—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∑—ã–≤—ã", "–û–±–Ω–æ–≤–∏—Ç—å —á–∞—Ç—ã", "–û–±–Ω–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 4 –º–∞–≥–∞–∑–∏–Ω–æ–≤. –ò—Ç–æ–≥–æ: 12 –∫–Ω–æ–ø–æ–∫ √ó 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å = 60 –∫–ª–∏–∫–æ–≤/–¥–µ–Ω—å.

---

## Solution (–†–µ—à–µ–Ω–∏–µ)

–í–Ω–µ–¥—Ä–∏—Ç—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –¥–∞–Ω–Ω—ã—Ö —Å Wildberries API –ø–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–º—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Cloud Scheduler (Google Cloud)
    ‚Üì triggers every N minutes
Firebase Cloud Function
    ‚Üì –≤—ã–∑—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API endpoints
Next.js API Routes (/api/stores/reviews/update-all)
    ‚Üì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç server actions
refreshReviewsForStore() / updateDialoguesForStore()
    ‚Üì –æ–±–Ω–æ–≤–ª—è–µ—Ç Firestore
```

---

## Success Criteria (–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞)

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- ‚úÖ –û—Ç–∑—ã–≤—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ß–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ê–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∞ –≤ no-reply —á–∞—Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00 –∏ 18:00
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ UI
- ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ú–µ—Ç—Ä–∏–∫–∏:
- üìä **Adoption Rate:** 100% –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚è±Ô∏è **Time to Response:** 24—á ‚Üí 2—á (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏)
- üí∞ **Time Saved:** 8 —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìà **Review Response Rate:** +40% (–±–æ–ª—å—à–µ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã)

---

## User Stories

### US-001: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
**As a** –ø—Ä–æ–¥–∞–≤–µ—Ü –Ω–∞ WB
**I want** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
**So that** —è –º–æ–≥—É –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ feedback –∫–ª–∏–µ–Ω—Ç–æ–≤

**Acceptance Criteria:**
- [ ] Cloud Function –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- [ ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è incremental —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã)
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ Firestore + email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- [ ] –í UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ú–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å"

**Story Points:** 5

**Tasks:**
- [TASK-001] –°–æ–∑–¥–∞—Ç—å Cloud Function `scheduledReviewUpdates`
- [TASK-002] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cloud Scheduler (cron: */30 * * * *)
- [TASK-003] –î–æ–±–∞–≤–∏—Ç—å error handling –∏ retry logic
- [TASK-004] –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [TASK-005] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 1 –º–∞–≥–∞–∑–∏–Ω–µ –≤ production

---

### US-002: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤
**As a** –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
**I want** –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
**So that** —è –º–æ–≥—É –æ—Ç–≤–µ—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞

**Acceptance Criteria:**
- [ ] Cloud Function –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- [ ] Cursor (lastChatUpdateNext) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] AI –ø–µ—Ä–µ-–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–µ–≥–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
- [ ] Rate limiting WB API (500ms –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –º–∞–≥–∞–∑–∏–Ω–∞–º–∏)

**Story Points:** 5

**Tasks:**
- [TASK-006] –°–æ–∑–¥–∞—Ç—å Cloud Function `scheduledChatUpdates`
- [TASK-007] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cloud Scheduler (cron: */10 * * * *)
- [TASK-008] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å AI-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- [TASK-009] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Cloud Monitoring
- [TASK-010] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ 10 –º–∞–≥–∞–∑–∏–Ω–æ–≤

---

### US-003: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∞ no-reply
**As a** –ø—Ä–æ–¥–∞–≤–µ—Ü
**I want** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å follow-up —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏
**So that** —è –º–æ–≥—É –∑–∞–∫—Ä—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ —á–∞—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ

**Acceptance Criteria:**
- [ ] –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00 –∏ 18:00 –ú–°–ö
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–∞—Ç—ã —Å —Ç–µ–≥–æ–º `no_reply`
- [ ] –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç > 1 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ 24 —á–∞—Å–∞ –æ–¥–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
- [ ] –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –∫–æ–ª-–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö, –æ—à–∏–±–∫–∏
- [ ] UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–∞—Å—Å—ã–ª–æ–∫ (–¥–∞—Ç–∞, –∫–æ–ª-–≤–æ —á–∞—Ç–æ–≤)

**Story Points:** 3

**Tasks:**
- [TASK-011] –°–æ–∑–¥–∞—Ç—å Cloud Function `scheduledNoReplyMessages`
- [TASK-012] –î–æ–±–∞–≤–∏—Ç—å debouncing (lastAutoMessageSentDate)
- [TASK-013] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å timezone Europe/Moscow
- [TASK-014] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ª–æ–≥–∞–º–∏ —Ä–∞—Å—Å—ã–ª–æ–∫
- [TASK-015] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏

---

### US-004: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ UI
**As a** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
**I want** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
**So that** —è –º–æ–≥—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã

**Acceptance Criteria:**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí —Ä–∞–∑–¥–µ–ª "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è"
- [ ] –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤, —á–∞—Ç–æ–≤
- [ ] –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª (5, 10, 15, 30, 60 –º–∏–Ω—É—Ç)
- [ ] –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º—è –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–∫–∏ (10:00, 14:00, 18:00, 22:00)
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω—É—Ç—ã
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: "–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ 14:35"

**Story Points:** 8

**Tasks:**
- [TASK-016] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ `user_settings`: `autoSyncEnabled`, `reviewSyncInterval`, etc
- [TASK-017] –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- [TASK-018] Cloud Functions —á–∏—Ç–∞—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ Firestore
- [TASK-019] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ cron schedule
- [TASK-020] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è UI

---

## Technical Implementation

### Architecture Diagram
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cloud Scheduler (Google Cloud Platform)   ‚îÇ
‚îÇ  - scheduledReviewUpdates: */30 * * * *     ‚îÇ
‚îÇ  - scheduledChatUpdates:   */10 * * * *     ‚îÇ
‚îÇ  - scheduledNoReply:       0 10,18 * * *    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ HTTP POST trigger
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Firebase Cloud Functions (Node.js)         ‚îÇ
‚îÇ  - –ß–∏—Ç–∞–µ—Ç user_settings –∏–∑ Firestore        ‚îÇ
‚îÇ  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç autoSyncEnabled                ‚îÇ
‚îÇ  - –í—ã–∑—ã–≤–∞–µ—Ç API endpoints                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ Internal API call
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Next.js API Routes                         ‚îÇ
‚îÇ  /api/stores/reviews/update-all             ‚îÇ
‚îÇ  /api/stores/dialogues/update-all           ‚îÇ
‚îÇ  /api/stores/dialogues/send-no-reply-all    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ Server Actions
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Server Actions (lib/server-actions/)       ‚îÇ
‚îÇ  - refreshReviewsForStore()                 ‚îÇ
‚îÇ  - updateDialoguesForStore()                ‚îÇ
‚îÇ  - sendNoReplyMessagesForStore()            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ Updates
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Firestore Database                         ‚îÇ
‚îÇ  - stores/                                  ‚îÇ
‚îÇ  - products/                                ‚îÇ
‚îÇ  - reviews/                                 ‚îÇ
‚îÇ  - chats/                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Code Example: Cloud Function

```typescript
// functions/src/scheduled-tasks.ts
import * as functions from 'firebase-functions';
import * as admin from 'firebase-admin';

export const scheduledReviewUpdates = functions.pubsub
  .schedule('every 30 minutes')
  .timeZone('Europe/Moscow')
  .onRun(async (context) => {
    const firestore = admin.firestore();

    // –ß–∏—Ç–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const settingsSnap = await firestore.collection('user_settings').limit(1).get();
    if (settingsSnap.empty) return;
    const settings = settingsSnap.docs[0].data();

    if (!settings.autoReviewSyncEnabled) {
      console.log('Auto review sync is disabled');
      return;
    }

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã
    const storesSnap = await firestore.collection('stores').get();

    for (const storeDoc of storesSnap.docs) {
      try {
        const storeId = storeDoc.id;
        console.log(`[AUTO-SYNC] Starting review update for store ${storeId}`);

        // –í—ã–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π server action
        const { refreshReviewsForStore } = await import('../../src/lib/server-actions/refresh-reviews');
        await refreshReviewsForStore(storeId, 'incremental');

        console.log(`[AUTO-SYNC] Successfully updated reviews for store ${storeId}`);
      } catch (error) {
        console.error(`[AUTO-SYNC] Failed for store ${storeDoc.id}:`, error);

        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –≤ Firestore
        await firestore.collection('sync_errors').add({
          storeId: storeDoc.id,
          type: 'reviews',
          error: error.message,
          timestamp: admin.firestore.FieldValue.serverTimestamp(),
        });

        // TODO: –û—Ç–ø—Ä–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      }

      // Rate limiting
      await new Promise(resolve => setTimeout(resolve, 500));
    }

    return null;
  });
```

### Deployment

```bash
# 1. Install Firebase CLI
npm install -g firebase-tools

# 2. Login
firebase login

# 3. Initialize Functions
firebase init functions

# 4. Deploy
firebase deploy --only functions
```

### Configuration

```javascript
// firebase.json
{
  "functions": {
    "source": "functions",
    "runtime": "nodejs18",
    "region": "europe-west1"
  }
}
```

---

## Dependencies

### External:
- Google Cloud Scheduler
- Firebase Cloud Functions
- Wildberries API (feedbacks-api, buyer-chat-api)

### Internal:
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ server actions —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã ‚úÖ
- Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ ‚úÖ
- Next.js API routes —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ

---

## Risks & Mitigation

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| WB API rate limits | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –î–æ–±–∞–≤–∏—Ç—å 500ms –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ |
| Cloud Function timeout (9 –º–∏–Ω) | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ 1 –º–∞–≥–∞–∑–∏–Ω—É –∑–∞ –≤—ã–∑–æ–≤ |
| –û—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Retry logic + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| –†–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ Cloud Functions | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–æ–µ | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ costs, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ |

---

## Testing Strategy

### Unit Tests:
- [ ] Cloud Function –≤—ã–∑—ã–≤–∞–µ—Ç server actions –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Error handling —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Retry logic —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ 429

### Integration Tests:
- [ ] End-to-end: Scheduler ‚Üí Function ‚Üí Firestore
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ staging environment

### Manual Testing:
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ 1 –º–∞–≥–∞–∑–∏–Ω–µ –≤ production
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å 3 –¥–Ω—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Cloud Logging
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

---

## Rollout Plan

### Phase 1: Development (–ù–µ–¥–µ–ª—è 1)
- [ ] –°–æ–∑–¥–∞—Ç—å Cloud Functions
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cloud Scheduler
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å Firebase Emulator

### Phase 2: Staging (–ù–µ–¥–µ–ª—è 2)
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ staging environment
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 1 –º–∞–≥–∞–∑–∏–Ω–æ–º
- [ ] –§–∏–∫—Å–∏–Ω–≥ –±–∞–≥–æ–≤

### Phase 3: Production (–ù–µ–¥–µ–ª—è 3)
- [ ] –í–∫–ª—é—á–∏—Ç—å –¥–ª—è 2 –º–∞–≥–∞–∑–∏–Ω–æ–≤ (beta)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 3 –¥–Ω—è
- [ ] –°–±–æ—Ä feedback

### Phase 4: Full Rollout (–ù–µ–¥–µ–ª—è 4)
- [ ] –í–∫–ª—é—á–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## Success Metrics - KPIs

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
- Manual syncs per day: 60 (12 –∫–Ω–æ–ø–æ–∫ √ó 5 —Ä–∞–∑)
- Average response time: 24 —á–∞—Å–∞
- Review response rate: 45%

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (—á–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü):
- Manual syncs per day: 0
- Average response time: < 2 —á–∞—Å–∞
- Review response rate: > 65%
- Time saved per user: 8 —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é

---

## Next Epic

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è EPIC-001 –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ [EPIC-002: –£–ª—É—á—à–µ–Ω–∏–µ AI-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏](./EPIC-002-ai-improvements.md)

---

**Created:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**Last Updated:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**Status:** üìÖ Planned for Sprint 1
