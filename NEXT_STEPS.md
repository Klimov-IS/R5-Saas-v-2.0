# –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ | TASK-M01

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞
**–°–ª–µ–¥—É—é—â–µ–µ:** –°–æ–∑–¥–∞—Ç—å PostgreSQL –∫–ª–∞—Å—Ç–µ—Ä –≤ Yandex Cloud

---

## üéØ –ß—Ç–æ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏:

‚úÖ –°–æ–∑–¥–∞–ª–∏ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ `wb-reputation-supabase`
‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ Supabase (`supabase init`)
‚úÖ –°–æ–∑–¥–∞–ª–∏ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤:
  - README.md
  - YANDEX_POSTGRESQL_SETUP.md
  - .env.example
  - .gitignore
‚úÖ –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é: –±–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ PostgreSQL (10 —Ç–∞–±–ª–∏—Ü)

---

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (TASK-M01):

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å PostgreSQL –∫–ª–∞—Å—Ç–µ—Ä –≤ Yandex Cloud (30-40 –º–∏–Ω—É—Ç)

–û—Ç–∫—Ä–æ–π—Ç–µ –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
üëâ **[YANDEX_POSTGRESQL_SETUP.md](./YANDEX_POSTGRESQL_SETUP.md)**

**–ö—Ä–∞—Ç–∫–æ:**
1. –ó–∞–π—Ç–∏ –≤ https://console.cloud.yandex.ru
2. Managed Service for PostgreSQL ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - –ò–º—è: `wb-reputation-prod-db`
   - PostgreSQL 15
   - s2.small (2 vCPU, 8 GB RAM)
   - 50 GB SSD
   - –ó–æ–Ω–∞: ru-central1-a (–ú–æ—Å–∫–≤–∞)
4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `wb_reputation`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `admin` + —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
6. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä (–∂–¥–∞—Ç—å 5-10 –º–∏–Ω—É—Ç)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–ª—É—á–∏—Ç–µ FQDN —Ö–æ—Å—Ç–∞: `c-xxxxx.rw.mdb.yandexcloud.net`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ 1Password/Bitwarden

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ psql
psql "host=c-xxxxx.rw.mdb.yandexcloud.net port=6432 dbname=wb_reputation user=admin password=<–í–ê–®_–ü–ê–†–û–õ–¨> sslmode=verify-full"

# –í psql –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
SELECT version();

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# PostgreSQL 15.5 ...
```

–ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –®–∞–≥—É 3

---

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å .env.local (2 –º–∏–Ω—É—Ç—ã)

```bash
# –í –∫–æ—Ä–Ω–µ wb-reputation-supabase —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env.local
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ .env.example –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

DATABASE_URL="postgresql://admin:<–í–ê–®_–ü–ê–†–û–õ–¨>@c-xxxxx.rw.mdb.yandexcloud.net:6432/wb_reputation?sslmode=verify-full"
```

---

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ Yandex Cloud –ë–î (5 –º–∏–Ω—É—Ç)

```bash
# –í –ø–∞–ø–∫–µ wb-reputation-supabase

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
npx supabase db push --db-url "postgresql://admin:<–ü–ê–†–û–õ–¨>@c-xxx.rw.mdb.yandexcloud.net:6432/wb_reputation?sslmode=verify-full"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í Yandex Cloud PostgreSQL —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –≤—Å–µ 10 —Ç–∞–±–ª–∏—Ü –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏.

---

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã (2 –º–∏–Ω—É—Ç—ã)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql "host=c-xxx... (connection string)"

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# public | stores
# public | products
# public | reviews
# public | chats
# public | chat_messages
# public | questions
# public | user_settings
# public | sync_errors
# public | audit_log
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç TASK-M01:

- [ ] Yandex Cloud PostgreSQL –∫–ª–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω
- [ ] FQDN —Ö–æ—Å—Ç–∞ –ø–æ–ª—É—á–µ–Ω
- [ ] –ü–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ –ø–∞—Ä–æ–ª–µ–π
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql —É—Å–ø–µ—à–Ω–æ
- [ ] .env.local —Å–æ–∑–¥–∞–Ω
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (`supabase db push`)
- [ ] –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `\dt`)

**–ö–æ–≥–¥–∞ –≤—Å–µ –≥–∞–ª–æ—á–∫–∏ ‚úÖ ‚Üí TASK-M01 DONE!**

---

## üéâ –ü–æ—Å–ª–µ TASK-M01:

–°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ (–Ω–µ –¥–µ–ª–∞—Ç—å –ø–æ–∫–∞ TASK-M01 –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω):

- TASK-M02: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ç—å –∏ security groups
- TASK-M03: –°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ë–î
- TASK-M04: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å latency
- TASK-M05: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Security Group —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ—Ä—Ç 6432
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ "–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø" = –î–∞
3. –°–º. [YANDEX_POSTGRESQL_SETUP.md - Troubleshooting](./YANDEX_POSTGRESQL_SETUP.md#troubleshooting)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ connection string (–ø–∞—Ä–æ–ª—å, —Ö–æ—Å—Ç, –ø–æ—Ä—Ç)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–∞–∑–∞ `wb_reputation` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é:
   ```bash
   psql "connection string" < supabase/migrations/20250101000000_create_base_schema.sql
   ```

---

## üìû –ü–æ–º–æ—â—å:

- Telegram: Migration Channel
- GitHub Issues: —Ç–µ–≥ `sprint-m1`

---

**Last Updated:** 30 –¥–µ–∫–∞–±—Ä—è 2024
**Next Review:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TASK-M01
